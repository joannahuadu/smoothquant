nohup: ignoring input
Running with alpha=0.0
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
N:M Sparsity: 2: 4
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:10,  3.66s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:07<00:06,  3.49s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:10<00:03,  3.30s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.30s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.72s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:87: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:11<25:57, 11.13s/it]Evaluating...:   1%|▏         | 2/141 [00:21<25:11, 10.88s/it]Evaluating...:   2%|▏         | 3/141 [00:32<24:51, 10.81s/it]Evaluating...:   3%|▎         | 4/141 [00:43<24:35, 10.77s/it]Evaluating...:   4%|▎         | 5/141 [00:53<24:22, 10.75s/it]Evaluating...:   4%|▍         | 6/141 [01:04<24:10, 10.74s/it]Evaluating...:   5%|▍         | 7/141 [01:15<23:58, 10.74s/it]Evaluating...:   6%|▌         | 8/141 [01:26<23:47, 10.74s/it]Evaluating...:   6%|▋         | 9/141 [01:36<23:35, 10.73s/it]Evaluating...:   7%|▋         | 10/141 [01:47<23:27, 10.74s/it]Evaluating...:   8%|▊         | 11/141 [01:58<23:18, 10.76s/it]Evaluating...:   9%|▊         | 12/141 [02:09<23:07, 10.76s/it]Evaluating...:   9%|▉         | 13/141 [02:19<22:55, 10.74s/it]Evaluating...:  10%|▉         | 14/141 [02:30<22:43, 10.73s/it]Evaluating...:  11%|█         | 15/141 [02:41<22:31, 10.73s/it]Evaluating...:  11%|█▏        | 16/141 [02:52<22:20, 10.72s/it]Evaluating...:  12%|█▏        | 17/141 [03:02<22:08, 10.71s/it]Evaluating...:  13%|█▎        | 18/141 [03:13<21:57, 10.71s/it]Evaluating...:  13%|█▎        | 19/141 [03:24<21:47, 10.71s/it]Evaluating...:  14%|█▍        | 20/141 [03:34<21:36, 10.71s/it]Evaluating...:  15%|█▍        | 21/141 [03:45<21:25, 10.71s/it]Evaluating...:  16%|█▌        | 22/141 [03:56<21:15, 10.72s/it]Evaluating...:  16%|█▋        | 23/141 [04:07<21:04, 10.71s/it]Evaluating...:  17%|█▋        | 24/141 [04:17<20:53, 10.71s/it]Evaluating...:  18%|█▊        | 25/141 [04:28<20:43, 10.72s/it]Evaluating...:  18%|█▊        | 26/141 [04:39<20:32, 10.72s/it]Evaluating...:  19%|█▉        | 27/141 [04:49<20:24, 10.74s/it]Evaluating...:  20%|█▉        | 28/141 [05:00<20:12, 10.73s/it]Evaluating...:  21%|██        | 29/141 [05:11<20:01, 10.73s/it]Evaluating...:  21%|██▏       | 30/141 [05:22<19:49, 10.72s/it]Evaluating...:  22%|██▏       | 31/141 [05:32<19:38, 10.71s/it]Evaluating...:  23%|██▎       | 32/141 [05:43<19:27, 10.71s/it]Evaluating...:  23%|██▎       | 33/141 [05:54<19:16, 10.71s/it]Evaluating...:  24%|██▍       | 34/141 [06:04<19:08, 10.73s/it]Evaluating...:  25%|██▍       | 35/141 [06:15<18:57, 10.73s/it]Evaluating...:  26%|██▌       | 36/141 [06:26<18:47, 10.74s/it]Evaluating...:  26%|██▌       | 37/141 [06:37<18:36, 10.73s/it]Evaluating...:  27%|██▋       | 38/141 [06:47<18:24, 10.72s/it]Evaluating...:  28%|██▊       | 39/141 [06:58<18:13, 10.72s/it]Evaluating...:  28%|██▊       | 40/141 [07:09<18:01, 10.71s/it]Evaluating...:  29%|██▉       | 41/141 [07:20<17:51, 10.71s/it]Evaluating...:  30%|██▉       | 42/141 [07:30<17:40, 10.71s/it]Evaluating...:  30%|███       | 43/141 [07:41<17:28, 10.70s/it]Evaluating...:  31%|███       | 44/141 [07:52<17:17, 10.70s/it]Evaluating...:  32%|███▏      | 45/141 [08:02<17:06, 10.70s/it]Evaluating...:  33%|███▎      | 46/141 [08:13<16:56, 10.70s/it]Evaluating...:  33%|███▎      | 47/141 [08:24<16:46, 10.70s/it]Evaluating...:  34%|███▍      | 48/141 [08:34<16:36, 10.71s/it]Evaluating...:  35%|███▍      | 49/141 [08:45<16:25, 10.71s/it]Evaluating...:  35%|███▌      | 50/141 [08:56<16:15, 10.72s/it]Evaluating...:  36%|███▌      | 51/141 [09:07<16:04, 10.72s/it]Evaluating...:  37%|███▋      | 52/141 [09:17<15:53, 10.72s/it]Evaluating...:  38%|███▊      | 53/141 [09:28<15:43, 10.73s/it]Evaluating...:  38%|███▊      | 54/141 [09:39<15:33, 10.73s/it]Evaluating...:  39%|███▉      | 55/141 [09:50<15:21, 10.72s/it]Evaluating...:  40%|███▉      | 56/141 [10:00<15:09, 10.70s/it]Evaluating...:  40%|████      | 57/141 [10:11<14:58, 10.70s/it]Evaluating...:  41%|████      | 58/141 [10:22<14:47, 10.70s/it]Evaluating...:  42%|████▏     | 59/141 [10:32<14:36, 10.69s/it]Evaluating...:  43%|████▎     | 60/141 [10:43<14:25, 10.69s/it]Evaluating...:  43%|████▎     | 61/141 [10:54<14:14, 10.69s/it]Evaluating...:  44%|████▍     | 62/141 [11:04<14:04, 10.69s/it]Evaluating...:  45%|████▍     | 63/141 [11:15<13:54, 10.70s/it]Evaluating...:  45%|████▌     | 64/141 [11:26<13:42, 10.69s/it]Evaluating...:  46%|████▌     | 65/141 [11:36<13:31, 10.67s/it]Evaluating...:  47%|████▋     | 66/141 [11:47<13:20, 10.67s/it]Evaluating...:  48%|████▊     | 67/141 [11:58<13:10, 10.69s/it]Evaluating...:  48%|████▊     | 68/141 [12:08<13:00, 10.69s/it]Evaluating...:  49%|████▉     | 69/141 [12:20<12:59, 10.83s/it]Evaluating...:  50%|████▉     | 70/141 [12:31<13:04, 11.05s/it]Evaluating...:  50%|█████     | 71/141 [12:42<12:59, 11.13s/it]Evaluating...:  51%|█████     | 72/141 [12:54<12:53, 11.21s/it]Evaluating...:  52%|█████▏    | 73/141 [13:05<12:44, 11.24s/it]Evaluating...:  52%|█████▏    | 74/141 [13:16<12:35, 11.28s/it]Evaluating...:  53%|█████▎    | 75/141 [13:28<12:30, 11.38s/it]Evaluating...:  54%|█████▍    | 76/141 [13:40<12:19, 11.38s/it]Evaluating...:  55%|█████▍    | 77/141 [13:51<12:09, 11.40s/it]Evaluating...:  55%|█████▌    | 78/141 [14:02<11:59, 11.42s/it]Evaluating...:  56%|█████▌    | 79/141 [14:14<11:51, 11.48s/it]Evaluating...:  57%|█████▋    | 80/141 [14:25<11:39, 11.46s/it]Evaluating...:  57%|█████▋    | 81/141 [14:37<11:29, 11.49s/it]Evaluating...:  58%|█████▊    | 82/141 [14:49<11:23, 11.59s/it]Evaluating...:  59%|█████▉    | 83/141 [15:01<11:17, 11.69s/it]Evaluating...:  60%|█████▉    | 84/141 [15:13<11:11, 11.79s/it]Evaluating...:  60%|██████    | 85/141 [15:25<11:03, 11.85s/it]Evaluating...:  61%|██████    | 86/141 [15:37<10:54, 11.90s/it]Evaluating...:  62%|██████▏   | 87/141 [15:49<10:43, 11.92s/it]Evaluating...:  62%|██████▏   | 88/141 [16:01<10:31, 11.91s/it]Evaluating...:  63%|██████▎   | 89/141 [16:13<10:23, 11.99s/it]Evaluating...:  64%|██████▍   | 90/141 [16:25<10:12, 12.01s/it]Evaluating...:  65%|██████▍   | 91/141 [16:37<09:59, 11.98s/it]Evaluating...:  65%|██████▌   | 92/141 [16:49<09:47, 12.00s/it]Evaluating...:  66%|██████▌   | 93/141 [17:01<09:36, 12.02s/it]Evaluating...:  67%|██████▋   | 94/141 [17:13<09:24, 12.02s/it]Evaluating...:  67%|██████▋   | 95/141 [17:25<09:12, 12.01s/it]Evaluating...:  68%|██████▊   | 96/141 [17:37<08:58, 11.97s/it]Evaluating...:  69%|██████▉   | 97/141 [17:49<08:45, 11.95s/it]Evaluating...:  70%|██████▉   | 98/141 [18:01<08:34, 11.96s/it]Evaluating...:  70%|███████   | 99/141 [18:13<08:22, 11.96s/it]Evaluating...:  71%|███████   | 100/141 [18:25<08:10, 11.97s/it]Evaluating...:  72%|███████▏  | 101/141 [18:37<08:00, 12.01s/it]Evaluating...:  72%|███████▏  | 102/141 [18:49<07:48, 12.01s/it]Evaluating...:  73%|███████▎  | 103/141 [19:01<07:35, 11.98s/it]Evaluating...:  74%|███████▍  | 104/141 [19:13<07:21, 11.95s/it]Evaluating...:  74%|███████▍  | 105/141 [19:24<07:01, 11.69s/it]Evaluating...:  75%|███████▌  | 106/141 [19:35<06:42, 11.51s/it]Evaluating...:  76%|███████▌  | 107/141 [19:46<06:26, 11.36s/it]Evaluating...:  77%|███████▋  | 108/141 [19:57<06:11, 11.27s/it]Evaluating...:  77%|███████▋  | 109/141 [20:08<05:59, 11.22s/it]Evaluating...:  78%|███████▊  | 110/141 [20:19<05:47, 11.21s/it]Evaluating...:  79%|███████▊  | 111/141 [20:30<05:35, 11.19s/it]Evaluating...:  79%|███████▉  | 112/141 [20:41<05:22, 11.13s/it]Evaluating...:  80%|████████  | 113/141 [20:52<05:11, 11.11s/it]Evaluating...:  81%|████████  | 114/141 [21:03<04:58, 11.04s/it]Evaluating...:  82%|████████▏ | 115/141 [21:14<04:47, 11.05s/it]Evaluating...:  82%|████████▏ | 116/141 [21:25<04:35, 11.04s/it]Evaluating...:  83%|████████▎ | 117/141 [21:36<04:26, 11.08s/it]Evaluating...:  84%|████████▎ | 118/141 [21:47<04:14, 11.05s/it]Evaluating...:  84%|████████▍ | 119/141 [21:58<04:02, 11.03s/it]Evaluating...:  85%|████████▌ | 120/141 [22:09<03:51, 11.01s/it]Evaluating...:  86%|████████▌ | 121/141 [22:20<03:40, 11.03s/it]Evaluating...:  87%|████████▋ | 122/141 [22:31<03:28, 10.99s/it]Evaluating...:  87%|████████▋ | 123/141 [22:42<03:17, 10.97s/it]Evaluating...:  88%|████████▊ | 124/141 [22:53<03:07, 11.06s/it]Evaluating...:  89%|████████▊ | 125/141 [23:05<02:57, 11.08s/it]Evaluating...:  89%|████████▉ | 126/141 [23:16<02:45, 11.04s/it]Evaluating...:  90%|█████████ | 127/141 [23:27<02:34, 11.02s/it]Evaluating...:  91%|█████████ | 128/141 [23:37<02:22, 11.00s/it]Evaluating...:  91%|█████████▏| 129/141 [23:48<02:11, 10.96s/it]Evaluating...:  92%|█████████▏| 130/141 [23:59<02:00, 10.96s/it]Evaluating...:  93%|█████████▎| 131/141 [24:10<01:49, 10.98s/it]Evaluating...:  94%|█████████▎| 132/141 [24:21<01:38, 10.97s/it]Evaluating...:  94%|█████████▍| 133/141 [24:32<01:27, 10.98s/it]Evaluating...:  95%|█████████▌| 134/141 [24:43<01:17, 11.02s/it]Evaluating...:  96%|█████████▌| 135/141 [24:55<01:06, 11.10s/it]Evaluating...:  96%|█████████▋| 136/141 [25:06<00:55, 11.12s/it]Evaluating...:  97%|█████████▋| 137/141 [25:17<00:44, 11.10s/it]Evaluating...:  98%|█████████▊| 138/141 [25:28<00:33, 11.07s/it]Evaluating...:  99%|█████████▊| 139/141 [25:39<00:22, 11.12s/it]Evaluating...:  99%|█████████▉| 140/141 [25:50<00:11, 11.11s/it]Evaluating...: 100%|██████████| 141/141 [26:01<00:00, 11.10s/it]Evaluating...: 100%|██████████| 141/141 [26:01<00:00, 11.08s/it]
Perplexity: 14.218574523925781
Running with alpha=0.15
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
N:M Sparsity: 2: 4
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:11,  3.78s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:07<00:07,  3.62s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:10<00:03,  3.57s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:11<00:00,  2.49s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:11<00:00,  2.91s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:87: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:11<26:25, 11.32s/it]Evaluating...:   1%|▏         | 2/141 [00:22<25:45, 11.12s/it]Evaluating...:   2%|▏         | 3/141 [00:33<25:23, 11.04s/it]Evaluating...:   3%|▎         | 4/141 [00:44<25:05, 10.99s/it]Evaluating...:   4%|▎         | 5/141 [00:55<24:52, 10.98s/it]Evaluating...:   4%|▍         | 6/141 [01:06<24:40, 10.97s/it]Evaluating...:   5%|▍         | 7/141 [01:16<24:26, 10.94s/it]Evaluating...:   6%|▌         | 8/141 [01:27<24:17, 10.96s/it]Evaluating...:   6%|▋         | 9/141 [01:38<24:08, 10.97s/it]Evaluating...:   7%|▋         | 10/141 [01:49<23:58, 10.98s/it]Evaluating...:   8%|▊         | 11/141 [02:00<23:47, 10.98s/it]Evaluating...:   9%|▊         | 12/141 [02:11<23:33, 10.96s/it]Evaluating...:   9%|▉         | 13/141 [02:22<23:20, 10.94s/it]Evaluating...:  10%|▉         | 14/141 [02:33<23:07, 10.92s/it]Evaluating...:  11%|█         | 15/141 [02:44<22:55, 10.91s/it]Evaluating...:  11%|█▏        | 16/141 [02:55<22:44, 10.91s/it]Evaluating...:  12%|█▏        | 17/141 [03:06<22:33, 10.92s/it]Evaluating...:  13%|█▎        | 18/141 [03:17<22:22, 10.92s/it]Evaluating...:  13%|█▎        | 19/141 [03:28<22:11, 10.92s/it]Evaluating...:  14%|█▍        | 20/141 [03:39<22:01, 10.92s/it]Evaluating...:  15%|█▍        | 21/141 [03:50<21:53, 10.94s/it]Evaluating...:  16%|█▌        | 22/141 [04:01<21:40, 10.93s/it]Evaluating...:  16%|█▋        | 23/141 [04:11<21:28, 10.92s/it]Evaluating...:  17%|█▋        | 24/141 [04:22<21:19, 10.93s/it]Evaluating...:  18%|█▊        | 25/141 [04:33<21:06, 10.92s/it]Evaluating...:  18%|█▊        | 26/141 [04:44<20:55, 10.92s/it]Evaluating...:  19%|█▉        | 27/141 [04:55<20:46, 10.94s/it]Evaluating...:  20%|█▉        | 28/141 [05:06<20:34, 10.92s/it]Evaluating...:  21%|██        | 29/141 [05:17<20:23, 10.93s/it]Evaluating...:  21%|██▏       | 30/141 [05:28<20:12, 10.92s/it]Evaluating...:  22%|██▏       | 31/141 [05:39<20:05, 10.96s/it]Evaluating...:  23%|██▎       | 32/141 [05:50<19:57, 10.98s/it]Evaluating...:  23%|██▎       | 33/141 [06:01<19:45, 10.97s/it]Evaluating...:  24%|██▍       | 34/141 [06:12<19:32, 10.95s/it]Evaluating...:  25%|██▍       | 35/141 [06:23<19:20, 10.95s/it]Evaluating...:  26%|██▌       | 36/141 [06:34<19:07, 10.93s/it]Evaluating...:  26%|██▌       | 37/141 [06:45<18:57, 10.94s/it]Evaluating...:  27%|██▋       | 38/141 [06:55<18:44, 10.92s/it]Evaluating...:  28%|██▊       | 39/141 [07:06<18:35, 10.94s/it]Evaluating...:  28%|██▊       | 40/141 [07:17<18:25, 10.94s/it]Evaluating...:  29%|██▉       | 41/141 [07:28<18:12, 10.93s/it]Evaluating...:  30%|██▉       | 42/141 [07:39<18:02, 10.93s/it]Evaluating...:  30%|███       | 43/141 [07:50<17:51, 10.93s/it]Evaluating...:  31%|███       | 44/141 [08:01<17:42, 10.95s/it]Evaluating...:  32%|███▏      | 45/141 [08:12<17:30, 10.94s/it]Evaluating...:  33%|███▎      | 46/141 [08:23<17:18, 10.93s/it]Evaluating...:  33%|███▎      | 47/141 [08:34<17:06, 10.92s/it]Evaluating...:  34%|███▍      | 48/141 [08:45<16:55, 10.92s/it]Evaluating...:  35%|███▍      | 49/141 [08:56<16:44, 10.91s/it]Evaluating...:  35%|███▌      | 50/141 [09:07<16:33, 10.92s/it]Evaluating...:  36%|███▌      | 51/141 [09:18<16:25, 10.95s/it]Evaluating...:  37%|███▋      | 52/141 [09:29<16:15, 10.96s/it]Evaluating...:  38%|███▊      | 53/141 [09:40<16:03, 10.95s/it]Evaluating...:  38%|███▊      | 54/141 [09:50<15:51, 10.93s/it]Evaluating...:  39%|███▉      | 55/141 [10:01<15:39, 10.93s/it]Evaluating...:  40%|███▉      | 56/141 [10:12<15:29, 10.93s/it]Evaluating...:  40%|████      | 57/141 [10:23<15:19, 10.94s/it]Evaluating...:  41%|████      | 58/141 [10:34<15:10, 10.96s/it]Evaluating...:  42%|████▏     | 59/141 [10:45<14:57, 10.94s/it]Evaluating...:  43%|████▎     | 60/141 [10:56<14:47, 10.95s/it]Evaluating...:  43%|████▎     | 61/141 [11:07<14:35, 10.94s/it]Evaluating...:  44%|████▍     | 62/141 [11:18<14:24, 10.95s/it]Evaluating...:  45%|████▍     | 63/141 [11:29<14:13, 10.94s/it]Evaluating...:  45%|████▌     | 64/141 [11:40<14:02, 10.94s/it]Evaluating...:  46%|████▌     | 65/141 [11:51<13:50, 10.92s/it]Evaluating...:  47%|████▋     | 66/141 [12:02<13:38, 10.92s/it]Evaluating...:  48%|████▊     | 67/141 [12:13<13:28, 10.93s/it]Evaluating...:  48%|████▊     | 68/141 [12:24<13:18, 10.94s/it]Evaluating...:  49%|████▉     | 69/141 [12:35<13:08, 10.95s/it]Evaluating...:  50%|████▉     | 70/141 [12:46<12:56, 10.94s/it]Evaluating...:  50%|█████     | 71/141 [12:56<12:44, 10.93s/it]Evaluating...:  51%|█████     | 72/141 [13:07<12:33, 10.92s/it]Evaluating...:  52%|█████▏    | 73/141 [13:18<12:24, 10.94s/it]Evaluating...:  52%|█████▏    | 74/141 [13:29<12:13, 10.95s/it]Evaluating...:  53%|█████▎    | 75/141 [13:40<12:03, 10.96s/it]Evaluating...:  54%|█████▍    | 76/141 [13:51<11:50, 10.92s/it]Evaluating...:  55%|█████▍    | 77/141 [14:02<11:38, 10.91s/it]Evaluating...:  55%|█████▌    | 78/141 [14:13<11:30, 10.95s/it]Evaluating...:  56%|█████▌    | 79/141 [14:24<11:18, 10.94s/it]Evaluating...:  57%|█████▋    | 80/141 [14:35<11:07, 10.94s/it]Evaluating...:  57%|█████▋    | 81/141 [14:46<10:56, 10.94s/it]Evaluating...:  58%|█████▊    | 82/141 [14:57<10:44, 10.93s/it]Evaluating...:  59%|█████▉    | 83/141 [15:08<10:34, 10.93s/it]Evaluating...:  60%|█████▉    | 84/141 [15:19<10:23, 10.95s/it]Evaluating...:  60%|██████    | 85/141 [15:30<10:13, 10.96s/it]Evaluating...:  61%|██████    | 86/141 [15:41<10:02, 10.96s/it]Evaluating...:  62%|██████▏   | 87/141 [15:52<09:51, 10.96s/it]Evaluating...:  62%|██████▏   | 88/141 [16:03<09:41, 10.97s/it]Evaluating...:  63%|██████▎   | 89/141 [16:14<09:30, 10.97s/it]Evaluating...:  64%|██████▍   | 90/141 [16:24<09:19, 10.96s/it]Evaluating...:  65%|██████▍   | 91/141 [16:35<09:06, 10.94s/it]Evaluating...:  65%|██████▌   | 92/141 [16:46<08:55, 10.93s/it]Evaluating...:  66%|██████▌   | 93/141 [16:57<08:44, 10.92s/it]Evaluating...:  67%|██████▋   | 94/141 [17:08<08:32, 10.91s/it]Evaluating...:  67%|██████▋   | 95/141 [17:19<08:22, 10.92s/it]Evaluating...:  68%|██████▊   | 96/141 [17:30<08:11, 10.91s/it]Evaluating...:  69%|██████▉   | 97/141 [17:41<08:00, 10.91s/it]Evaluating...:  70%|██████▉   | 98/141 [17:52<07:50, 10.94s/it]Evaluating...:  70%|███████   | 99/141 [18:03<07:41, 10.99s/it]Evaluating...:  71%|███████   | 100/141 [18:14<07:29, 10.97s/it]Evaluating...:  72%|███████▏  | 101/141 [18:25<07:18, 10.96s/it]Evaluating...:  72%|███████▏  | 102/141 [18:36<07:06, 10.93s/it]Evaluating...:  73%|███████▎  | 103/141 [18:47<06:55, 10.92s/it]Evaluating...:  74%|███████▍  | 104/141 [18:57<06:44, 10.92s/it]Evaluating...:  74%|███████▍  | 105/141 [19:08<06:33, 10.93s/it]Evaluating...:  75%|███████▌  | 106/141 [19:19<06:24, 10.98s/it]Evaluating...:  76%|███████▌  | 107/141 [19:30<06:12, 10.97s/it]Evaluating...:  77%|███████▋  | 108/141 [19:41<06:02, 10.98s/it]Evaluating...:  77%|███████▋  | 109/141 [19:52<05:51, 10.97s/it]Evaluating...:  78%|███████▊  | 110/141 [20:03<05:39, 10.95s/it]Evaluating...:  79%|███████▊  | 111/141 [20:14<05:28, 10.93s/it]Evaluating...:  79%|███████▉  | 112/141 [20:25<05:16, 10.92s/it]Evaluating...:  80%|████████  | 113/141 [20:36<05:06, 10.93s/it]Evaluating...:  81%|████████  | 114/141 [20:47<04:55, 10.96s/it]Evaluating...:  82%|████████▏ | 115/141 [20:58<04:44, 10.95s/it]Evaluating...:  82%|████████▏ | 116/141 [21:09<04:33, 10.95s/it]Evaluating...:  83%|████████▎ | 117/141 [21:20<04:22, 10.94s/it]Evaluating...:  84%|████████▎ | 118/141 [21:31<04:11, 10.93s/it]Evaluating...:  84%|████████▍ | 119/141 [21:42<04:00, 10.92s/it]Evaluating...:  85%|████████▌ | 120/141 [21:53<03:49, 10.93s/it]Evaluating...:  86%|████████▌ | 121/141 [22:04<03:38, 10.93s/it]Evaluating...:  87%|████████▋ | 122/141 [22:14<03:27, 10.94s/it]Evaluating...:  87%|████████▋ | 123/141 [22:25<03:16, 10.93s/it]Evaluating...:  88%|████████▊ | 124/141 [22:36<03:05, 10.94s/it]Evaluating...:  89%|████████▊ | 125/141 [22:47<02:55, 10.96s/it]Evaluating...:  89%|████████▉ | 126/141 [22:58<02:44, 10.96s/it]Evaluating...:  90%|█████████ | 127/141 [23:09<02:33, 10.97s/it]Evaluating...:  91%|█████████ | 128/141 [23:20<02:22, 10.96s/it]Evaluating...:  91%|█████████▏| 129/141 [23:31<02:11, 10.97s/it]Evaluating...:  92%|█████████▏| 130/141 [23:42<02:00, 10.96s/it]Evaluating...:  93%|█████████▎| 131/141 [23:53<01:49, 10.96s/it]Evaluating...:  94%|█████████▎| 132/141 [24:04<01:38, 10.95s/it]Evaluating...:  94%|█████████▍| 133/141 [24:15<01:27, 10.95s/it]Evaluating...:  95%|█████████▌| 134/141 [24:26<01:16, 10.92s/it]Evaluating...:  96%|█████████▌| 135/141 [24:37<01:05, 10.92s/it]Evaluating...:  96%|█████████▋| 136/141 [24:48<00:54, 10.93s/it]Evaluating...:  97%|█████████▋| 137/141 [24:59<00:43, 10.95s/it]Evaluating...:  98%|█████████▊| 138/141 [25:10<00:32, 10.97s/it]Evaluating...:  99%|█████████▊| 139/141 [25:21<00:21, 10.97s/it]Evaluating...:  99%|█████████▉| 140/141 [25:32<00:10, 10.96s/it]Evaluating...: 100%|██████████| 141/141 [25:43<00:00, 10.97s/it]Evaluating...: 100%|██████████| 141/141 [25:43<00:00, 10.94s/it]
Perplexity: 13.688374519348145
Running with alpha=0.25
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
N:M Sparsity: 2: 4
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:09,  3.33s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:06<00:06,  3.30s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:09<00:03,  3.24s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.31s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.67s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:87: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:11<26:42, 11.45s/it]Evaluating...:   1%|▏         | 2/141 [00:22<25:58, 11.21s/it]Evaluating...:   2%|▏         | 3/141 [00:33<25:34, 11.12s/it]Evaluating...:   3%|▎         | 4/141 [00:44<25:16, 11.07s/it]Evaluating...:   4%|▎         | 5/141 [00:55<25:01, 11.04s/it]Evaluating...:   4%|▍         | 6/141 [01:06<24:49, 11.03s/it]Evaluating...:   5%|▍         | 7/141 [01:17<24:38, 11.03s/it]Evaluating...:   6%|▌         | 8/141 [01:28<24:21, 10.99s/it]Evaluating...:   6%|▋         | 9/141 [01:39<24:08, 10.97s/it]Evaluating...:   7%|▋         | 10/141 [01:50<23:55, 10.96s/it]Evaluating...:   8%|▊         | 11/141 [02:01<23:44, 10.96s/it]Evaluating...:   9%|▊         | 12/141 [02:12<23:32, 10.95s/it]Evaluating...:   9%|▉         | 13/141 [02:23<23:20, 10.94s/it]Evaluating...:  10%|▉         | 14/141 [02:34<23:11, 10.96s/it]Evaluating...:  11%|█         | 15/141 [02:45<23:03, 10.98s/it]Evaluating...:  11%|█▏        | 16/141 [02:56<22:57, 11.02s/it]Evaluating...:  12%|█▏        | 17/141 [03:07<22:46, 11.02s/it]Evaluating...:  13%|█▎        | 18/141 [03:18<22:38, 11.04s/it]Evaluating...:  13%|█▎        | 19/141 [03:29<22:26, 11.04s/it]Evaluating...:  14%|█▍        | 20/141 [03:40<22:16, 11.05s/it]Evaluating...:  15%|█▍        | 21/141 [03:51<22:05, 11.05s/it]Evaluating...:  16%|█▌        | 22/141 [04:02<21:55, 11.06s/it]Evaluating...:  16%|█▋        | 23/141 [04:13<21:42, 11.04s/it]Evaluating...:  17%|█▋        | 24/141 [04:24<21:31, 11.04s/it]Evaluating...:  18%|█▊        | 25/141 [04:35<21:23, 11.07s/it]Evaluating...:  18%|█▊        | 26/141 [04:46<21:14, 11.09s/it]Evaluating...:  19%|█▉        | 27/141 [04:57<21:03, 11.08s/it]Evaluating...:  20%|█▉        | 28/141 [05:09<20:51, 11.08s/it]Evaluating...:  21%|██        | 29/141 [05:20<20:40, 11.08s/it]Evaluating...:  21%|██▏       | 30/141 [05:31<20:29, 11.08s/it]Evaluating...:  22%|██▏       | 31/141 [05:42<20:17, 11.07s/it]Evaluating...:  23%|██▎       | 32/141 [05:53<20:05, 11.06s/it]Evaluating...:  23%|██▎       | 33/141 [06:04<19:53, 11.05s/it]Evaluating...:  24%|██▍       | 34/141 [06:15<19:39, 11.03s/it]Evaluating...:  25%|██▍       | 35/141 [06:26<19:30, 11.04s/it]Evaluating...:  26%|██▌       | 36/141 [06:37<19:22, 11.07s/it]Evaluating...:  26%|██▌       | 37/141 [06:48<19:10, 11.06s/it]Evaluating...:  27%|██▋       | 38/141 [06:59<18:57, 11.04s/it]Evaluating...:  28%|██▊       | 39/141 [07:10<18:58, 11.16s/it]Evaluating...:  28%|██▊       | 40/141 [07:22<19:02, 11.31s/it]Evaluating...:  29%|██▉       | 41/141 [07:34<18:59, 11.39s/it]Evaluating...:  30%|██▉       | 42/141 [07:45<18:53, 11.45s/it]Evaluating...:  30%|███       | 43/141 [07:57<18:45, 11.49s/it]Evaluating...:  31%|███       | 44/141 [08:08<18:37, 11.52s/it]Evaluating...:  32%|███▏      | 45/141 [08:20<18:27, 11.53s/it]Evaluating...:  33%|███▎      | 46/141 [08:32<18:17, 11.55s/it]Evaluating...:  33%|███▎      | 47/141 [08:43<18:06, 11.56s/it]Evaluating...:  34%|███▍      | 48/141 [08:55<17:56, 11.57s/it]Evaluating...:  35%|███▍      | 49/141 [09:06<17:45, 11.58s/it]Evaluating...:  35%|███▌      | 50/141 [09:18<17:34, 11.59s/it]Evaluating...:  36%|███▌      | 51/141 [09:30<17:23, 11.59s/it]Evaluating...:  37%|███▋      | 52/141 [09:41<17:11, 11.59s/it]Evaluating...:  38%|███▊      | 53/141 [09:53<16:59, 11.59s/it]Evaluating...:  38%|███▊      | 54/141 [10:04<16:47, 11.58s/it]Evaluating...:  39%|███▉      | 55/141 [10:16<16:36, 11.58s/it]Evaluating...:  40%|███▉      | 56/141 [10:27<16:23, 11.57s/it]Evaluating...:  40%|████      | 57/141 [10:39<16:12, 11.58s/it]Evaluating...:  41%|████      | 58/141 [10:51<16:01, 11.58s/it]Evaluating...:  42%|████▏     | 59/141 [11:02<15:50, 11.59s/it]Evaluating...:  43%|████▎     | 60/141 [11:14<15:38, 11.59s/it]Evaluating...:  43%|████▎     | 61/141 [11:25<15:27, 11.60s/it]Evaluating...:  44%|████▍     | 62/141 [11:37<15:15, 11.59s/it]Evaluating...:  45%|████▍     | 63/141 [11:49<15:04, 11.60s/it]Evaluating...:  45%|████▌     | 64/141 [12:00<14:52, 11.59s/it]Evaluating...:  46%|████▌     | 65/141 [12:12<14:41, 11.59s/it]Evaluating...:  47%|████▋     | 66/141 [12:23<14:29, 11.59s/it]Evaluating...:  48%|████▊     | 67/141 [12:35<14:17, 11.59s/it]Evaluating...:  48%|████▊     | 68/141 [12:47<14:05, 11.59s/it]Evaluating...:  49%|████▉     | 69/141 [12:58<13:54, 11.59s/it]Evaluating...:  50%|████▉     | 70/141 [13:10<13:43, 11.59s/it]Evaluating...:  50%|█████     | 71/141 [13:21<13:31, 11.59s/it]Evaluating...:  51%|█████     | 72/141 [13:33<13:19, 11.58s/it]Evaluating...:  52%|█████▏    | 73/141 [13:44<13:07, 11.58s/it]Evaluating...:  52%|█████▏    | 74/141 [13:56<12:56, 11.59s/it]Evaluating...:  53%|█████▎    | 75/141 [14:08<12:45, 11.60s/it]Evaluating...:  54%|█████▍    | 76/141 [14:19<12:33, 11.59s/it]Evaluating...:  55%|█████▍    | 77/141 [14:31<12:21, 11.58s/it]Evaluating...:  55%|█████▌    | 78/141 [14:42<12:09, 11.58s/it]Evaluating...:  56%|█████▌    | 79/141 [14:54<11:58, 11.59s/it]Evaluating...:  57%|█████▋    | 80/141 [15:06<11:47, 11.59s/it]Evaluating...:  57%|█████▋    | 81/141 [15:17<11:35, 11.59s/it]Evaluating...:  58%|█████▊    | 82/141 [15:29<11:23, 11.59s/it]Evaluating...:  59%|█████▉    | 83/141 [15:40<11:12, 11.59s/it]Evaluating...:  60%|█████▉    | 84/141 [15:52<11:00, 11.59s/it]Evaluating...:  60%|██████    | 85/141 [16:04<10:49, 11.60s/it]Evaluating...:  61%|██████    | 86/141 [16:15<10:37, 11.59s/it]Evaluating...:  62%|██████▏   | 87/141 [16:27<10:26, 11.60s/it]Evaluating...:  62%|██████▏   | 88/141 [16:38<10:14, 11.60s/it]Evaluating...:  63%|██████▎   | 89/141 [16:50<10:02, 11.60s/it]Evaluating...:  64%|██████▍   | 90/141 [17:02<09:51, 11.60s/it]Evaluating...:  65%|██████▍   | 91/141 [17:13<09:39, 11.60s/it]Evaluating...:  65%|██████▌   | 92/141 [17:25<09:27, 11.59s/it]Evaluating...:  66%|██████▌   | 93/141 [17:36<09:16, 11.59s/it]Evaluating...:  67%|██████▋   | 94/141 [17:48<09:05, 11.60s/it]Evaluating...:  67%|██████▋   | 95/141 [18:00<08:53, 11.60s/it]Evaluating...:  68%|██████▊   | 96/141 [18:11<08:42, 11.60s/it]Evaluating...:  69%|██████▉   | 97/141 [18:23<08:30, 11.60s/it]Evaluating...:  70%|██████▉   | 98/141 [18:36<08:34, 11.96s/it]Evaluating...:  70%|███████   | 99/141 [18:48<08:26, 12.05s/it]Evaluating...:  71%|███████   | 100/141 [19:00<08:14, 12.05s/it]Evaluating...:  72%|███████▏  | 101/141 [19:12<08:03, 12.08s/it]Evaluating...:  72%|███████▏  | 102/141 [19:24<07:51, 12.08s/it]Evaluating...:  73%|███████▎  | 103/141 [19:36<07:40, 12.12s/it]Evaluating...:  74%|███████▍  | 104/141 [19:48<07:28, 12.11s/it]Evaluating...:  74%|███████▍  | 105/141 [20:01<07:15, 12.10s/it]Evaluating...:  75%|███████▌  | 106/141 [20:13<07:04, 12.12s/it]Evaluating...:  76%|███████▌  | 107/141 [20:25<06:53, 12.17s/it]Evaluating...:  77%|███████▋  | 108/141 [20:37<06:42, 12.19s/it]Evaluating...:  77%|███████▋  | 109/141 [20:50<06:31, 12.24s/it]Evaluating...:  78%|███████▊  | 110/141 [21:02<06:23, 12.38s/it]Evaluating...:  79%|███████▊  | 111/141 [21:15<06:14, 12.49s/it]Evaluating...:  79%|███████▉  | 112/141 [21:28<06:04, 12.56s/it]Evaluating...:  80%|████████  | 113/141 [21:40<05:52, 12.60s/it]Evaluating...:  81%|████████  | 114/141 [21:53<05:41, 12.65s/it]Evaluating...:  82%|████████▏ | 115/141 [22:06<05:28, 12.65s/it]Evaluating...:  82%|████████▏ | 116/141 [22:19<05:17, 12.69s/it]Evaluating...:  83%|████████▎ | 117/141 [22:31<05:05, 12.71s/it]Evaluating...:  84%|████████▎ | 118/141 [22:44<04:52, 12.71s/it]Evaluating...:  84%|████████▍ | 119/141 [22:57<04:39, 12.71s/it]Evaluating...:  85%|████████▌ | 120/141 [23:09<04:25, 12.66s/it]Evaluating...:  86%|████████▌ | 121/141 [23:22<04:13, 12.67s/it]Evaluating...:  87%|████████▋ | 122/141 [23:35<04:00, 12.68s/it]Evaluating...:  87%|████████▋ | 123/141 [23:47<03:48, 12.70s/it]Evaluating...:  88%|████████▊ | 124/141 [24:00<03:36, 12.76s/it]Evaluating...:  89%|████████▊ | 125/141 [24:13<03:24, 12.79s/it]Evaluating...:  89%|████████▉ | 126/141 [24:26<03:12, 12.83s/it]Evaluating...:  90%|█████████ | 127/141 [24:39<02:59, 12.83s/it]Evaluating...:  91%|█████████ | 128/141 [24:52<02:47, 12.85s/it]Evaluating...:  91%|█████████▏| 129/141 [25:05<02:34, 12.84s/it]Evaluating...:  92%|█████████▏| 130/141 [25:17<02:20, 12.79s/it]Evaluating...:  93%|█████████▎| 131/141 [25:30<02:05, 12.60s/it]Evaluating...:  94%|█████████▎| 132/141 [25:42<01:51, 12.43s/it]Evaluating...:  94%|█████████▍| 133/141 [25:54<01:38, 12.29s/it]Evaluating...:  95%|█████████▌| 134/141 [26:06<01:25, 12.26s/it]Evaluating...:  96%|█████████▌| 135/141 [26:18<01:13, 12.22s/it]Evaluating...:  96%|█████████▋| 136/141 [26:30<01:00, 12.18s/it]Evaluating...:  97%|█████████▋| 137/141 [26:42<00:48, 12.11s/it]Evaluating...:  98%|█████████▊| 138/141 [26:54<00:36, 12.07s/it]Evaluating...:  99%|█████████▊| 139/141 [27:06<00:24, 12.06s/it]Evaluating...:  99%|█████████▉| 140/141 [27:18<00:12, 12.04s/it]Evaluating...: 100%|██████████| 141/141 [27:30<00:00, 12.05s/it]Evaluating...: 100%|██████████| 141/141 [27:30<00:00, 11.71s/it]
Perplexity: 13.627776145935059
Running with alpha=0.5
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
W8A8 Quantization.
N:M Sparsity: 2: 4.
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:10,  3.43s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:06<00:06,  3.22s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:09<00:03,  3.17s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.25s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.61s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:102: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:11<25:50, 11.08s/it]Evaluating...:   1%|▏         | 2/141 [00:21<25:10, 10.86s/it]Evaluating...:   2%|▏         | 3/141 [00:32<24:49, 10.79s/it]Evaluating...:   3%|▎         | 4/141 [00:43<24:33, 10.76s/it]Evaluating...:   4%|▎         | 5/141 [00:54<24:25, 10.78s/it]Evaluating...:   4%|▍         | 6/141 [01:04<24:15, 10.78s/it]Evaluating...:   5%|▍         | 7/141 [01:15<24:06, 10.79s/it]Evaluating...:   6%|▌         | 8/141 [01:26<23:57, 10.81s/it]Evaluating...:   6%|▋         | 9/141 [01:37<23:46, 10.80s/it]Evaluating...:   7%|▋         | 10/141 [01:48<23:34, 10.80s/it]Evaluating...:   8%|▊         | 11/141 [01:58<23:21, 10.78s/it]Evaluating...:   9%|▊         | 12/141 [02:09<23:10, 10.78s/it]Evaluating...:   9%|▉         | 13/141 [02:20<22:59, 10.78s/it]Evaluating...:  10%|▉         | 14/141 [02:31<22:48, 10.78s/it]Evaluating...:  11%|█         | 15/141 [02:41<22:37, 10.78s/it]Evaluating...:  11%|█▏        | 16/141 [02:52<22:26, 10.77s/it]Evaluating...:  12%|█▏        | 17/141 [03:03<22:16, 10.78s/it]Evaluating...:  13%|█▎        | 18/141 [03:14<22:07, 10.79s/it]Evaluating...:  13%|█▎        | 19/141 [03:25<21:56, 10.79s/it]Evaluating...:  14%|█▍        | 20/141 [03:35<21:45, 10.79s/it]Evaluating...:  15%|█▍        | 21/141 [03:46<21:34, 10.79s/it]Evaluating...:  16%|█▌        | 22/141 [03:57<21:24, 10.79s/it]Evaluating...:  16%|█▋        | 23/141 [04:08<21:15, 10.81s/it]Evaluating...:  17%|█▋        | 24/141 [04:19<21:04, 10.81s/it]Evaluating...:  18%|█▊        | 25/141 [04:29<20:52, 10.80s/it]Evaluating...:  18%|█▊        | 26/141 [04:40<20:41, 10.79s/it]Evaluating...:  19%|█▉        | 27/141 [04:51<20:29, 10.78s/it]Evaluating...:  20%|█▉        | 28/141 [05:02<20:18, 10.78s/it]Evaluating...:  21%|██        | 29/141 [05:12<20:07, 10.78s/it]Evaluating...:  21%|██▏       | 30/141 [05:23<19:59, 10.81s/it]Evaluating...:  22%|██▏       | 31/141 [05:34<19:48, 10.81s/it]Evaluating...:  23%|██▎       | 32/141 [05:45<19:38, 10.82s/it]Evaluating...:  23%|██▎       | 33/141 [05:56<19:26, 10.80s/it]Evaluating...:  24%|██▍       | 34/141 [06:07<19:16, 10.81s/it]Evaluating...:  25%|██▍       | 35/141 [06:17<19:04, 10.80s/it]Evaluating...:  26%|██▌       | 36/141 [06:28<18:52, 10.79s/it]Evaluating...:  26%|██▌       | 37/141 [06:39<18:44, 10.81s/it]Evaluating...:  27%|██▋       | 38/141 [06:50<18:35, 10.83s/it]Evaluating...:  28%|██▊       | 39/141 [07:01<18:21, 10.80s/it]Evaluating...:  28%|██▊       | 40/141 [07:11<18:08, 10.78s/it]Evaluating...:  29%|██▉       | 41/141 [07:22<17:57, 10.78s/it]Evaluating...:  30%|██▉       | 42/141 [07:33<17:45, 10.77s/it]Evaluating...:  30%|███       | 43/141 [07:44<17:34, 10.76s/it]Evaluating...:  31%|███       | 44/141 [07:54<17:23, 10.76s/it]Evaluating...:  32%|███▏      | 45/141 [08:05<17:12, 10.76s/it]Evaluating...:  33%|███▎      | 46/141 [08:16<17:01, 10.76s/it]Evaluating...:  33%|███▎      | 47/141 [08:27<16:51, 10.76s/it]Evaluating...:  34%|███▍      | 48/141 [08:37<16:39, 10.75s/it]Evaluating...:  35%|███▍      | 49/141 [08:48<16:29, 10.75s/it]Evaluating...:  35%|███▌      | 50/141 [08:59<16:17, 10.74s/it]Evaluating...:  36%|███▌      | 51/141 [09:10<16:06, 10.74s/it]Evaluating...:  37%|███▋      | 52/141 [09:20<15:55, 10.73s/it]Evaluating...:  38%|███▊      | 53/141 [09:31<15:45, 10.74s/it]Evaluating...:  38%|███▊      | 54/141 [09:42<15:35, 10.75s/it]Evaluating...:  39%|███▉      | 55/141 [09:53<15:24, 10.75s/it]Evaluating...:  40%|███▉      | 56/141 [10:03<15:13, 10.75s/it]Evaluating...:  40%|████      | 57/141 [10:14<15:02, 10.74s/it]Evaluating...:  41%|████      | 58/141 [10:25<14:52, 10.75s/it]Evaluating...:  42%|████▏     | 59/141 [10:36<14:42, 10.76s/it]Evaluating...:  43%|████▎     | 60/141 [10:46<14:31, 10.76s/it]Evaluating...:  43%|████▎     | 61/141 [10:57<14:19, 10.74s/it]Evaluating...:  44%|████▍     | 62/141 [11:08<14:10, 10.77s/it]Evaluating...:  45%|████▍     | 63/141 [11:19<13:58, 10.76s/it]Evaluating...:  45%|████▌     | 64/141 [11:29<13:47, 10.75s/it]Evaluating...:  46%|████▌     | 65/141 [11:40<13:36, 10.75s/it]Evaluating...:  47%|████▋     | 66/141 [11:51<13:25, 10.74s/it]Evaluating...:  48%|████▊     | 67/141 [12:02<13:14, 10.74s/it]Evaluating...:  48%|████▊     | 68/141 [12:12<13:04, 10.74s/it]Evaluating...:  49%|████▉     | 69/141 [12:23<12:53, 10.75s/it]Evaluating...:  50%|████▉     | 70/141 [12:34<12:42, 10.73s/it]Evaluating...:  50%|█████     | 71/141 [12:44<12:30, 10.73s/it]Evaluating...:  51%|█████     | 72/141 [12:55<12:19, 10.72s/it]Evaluating...:  52%|█████▏    | 73/141 [13:06<12:08, 10.72s/it]Evaluating...:  52%|█████▏    | 74/141 [13:17<11:58, 10.72s/it]Evaluating...:  53%|█████▎    | 75/141 [13:27<11:47, 10.72s/it]Evaluating...:  54%|█████▍    | 76/141 [13:38<11:37, 10.73s/it]Evaluating...:  55%|█████▍    | 77/141 [13:49<11:26, 10.73s/it]Evaluating...:  55%|█████▌    | 78/141 [14:00<11:16, 10.74s/it]Evaluating...:  56%|█████▌    | 79/141 [14:10<11:05, 10.73s/it]Evaluating...:  57%|█████▋    | 80/141 [14:21<10:56, 10.76s/it]Evaluating...:  57%|█████▋    | 81/141 [14:32<10:44, 10.75s/it]Evaluating...:  58%|█████▊    | 82/141 [14:42<10:33, 10.74s/it]Evaluating...:  59%|█████▉    | 83/141 [14:53<10:22, 10.73s/it]Evaluating...:  60%|█████▉    | 84/141 [15:04<10:11, 10.73s/it]Evaluating...:  60%|██████    | 85/141 [15:15<10:00, 10.73s/it]Evaluating...:  61%|██████    | 86/141 [15:25<09:50, 10.74s/it]Evaluating...:  62%|██████▏   | 87/141 [15:36<09:39, 10.74s/it]Evaluating...:  62%|██████▏   | 88/141 [15:47<09:29, 10.75s/it]Evaluating...:  63%|██████▎   | 89/141 [15:58<09:18, 10.74s/it]Evaluating...:  64%|██████▍   | 90/141 [16:08<09:08, 10.75s/it]Evaluating...:  65%|██████▍   | 91/141 [16:19<08:57, 10.74s/it]Evaluating...:  65%|██████▌   | 92/141 [16:30<08:46, 10.74s/it]Evaluating...:  66%|██████▌   | 93/141 [16:41<08:35, 10.74s/it]Evaluating...:  67%|██████▋   | 94/141 [16:51<08:24, 10.74s/it]Evaluating...:  67%|██████▋   | 95/141 [17:02<08:15, 10.77s/it]Evaluating...:  68%|██████▊   | 96/141 [17:13<08:04, 10.76s/it]Evaluating...:  69%|██████▉   | 97/141 [17:24<07:53, 10.76s/it]Evaluating...:  70%|██████▉   | 98/141 [17:34<07:42, 10.75s/it]Evaluating...:  70%|███████   | 99/141 [17:45<07:31, 10.75s/it]Evaluating...:  71%|███████   | 100/141 [17:56<07:20, 10.75s/it]Evaluating...:  72%|███████▏  | 101/141 [18:07<07:09, 10.75s/it]Evaluating...:  72%|███████▏  | 102/141 [18:17<06:58, 10.74s/it]Evaluating...:  73%|███████▎  | 103/141 [18:28<06:47, 10.73s/it]Evaluating...:  74%|███████▍  | 104/141 [18:39<06:37, 10.73s/it]Evaluating...:  74%|███████▍  | 105/141 [18:50<06:26, 10.74s/it]Evaluating...:  75%|███████▌  | 106/141 [19:00<06:15, 10.74s/it]Evaluating...:  76%|███████▌  | 107/141 [19:11<06:05, 10.75s/it]Evaluating...:  77%|███████▋  | 108/141 [19:22<05:55, 10.79s/it]Evaluating...:  77%|███████▋  | 109/141 [19:33<05:44, 10.77s/it]Evaluating...:  78%|███████▊  | 110/141 [19:43<05:33, 10.77s/it]Evaluating...:  79%|███████▊  | 111/141 [19:54<05:22, 10.75s/it]Evaluating...:  79%|███████▉  | 112/141 [20:05<05:11, 10.74s/it]Evaluating...:  80%|████████  | 113/141 [20:16<05:01, 10.77s/it]Evaluating...:  81%|████████  | 114/141 [20:26<04:50, 10.77s/it]Evaluating...:  82%|████████▏ | 115/141 [20:37<04:39, 10.76s/it]Evaluating...:  82%|████████▏ | 116/141 [20:48<04:28, 10.75s/it]Evaluating...:  83%|████████▎ | 117/141 [20:59<04:18, 10.76s/it]Evaluating...:  84%|████████▎ | 118/141 [21:09<04:07, 10.75s/it]Evaluating...:  84%|████████▍ | 119/141 [21:20<03:56, 10.74s/it]Evaluating...:  85%|████████▌ | 120/141 [21:31<03:45, 10.73s/it]Evaluating...:  86%|████████▌ | 121/141 [21:42<03:34, 10.73s/it]Evaluating...:  87%|████████▋ | 122/141 [21:52<03:23, 10.73s/it]Evaluating...:  87%|████████▋ | 123/141 [22:03<03:13, 10.74s/it]Evaluating...:  88%|████████▊ | 124/141 [22:14<03:02, 10.74s/it]Evaluating...:  89%|████████▊ | 125/141 [22:25<02:51, 10.74s/it]Evaluating...:  89%|████████▉ | 126/141 [22:35<02:41, 10.74s/it]Evaluating...:  90%|█████████ | 127/141 [22:46<02:30, 10.74s/it]Evaluating...:  91%|█████████ | 128/141 [22:57<02:19, 10.74s/it]Evaluating...:  91%|█████████▏| 129/141 [23:08<02:08, 10.75s/it]Evaluating...:  92%|█████████▏| 130/141 [23:18<01:58, 10.76s/it]Evaluating...:  93%|█████████▎| 131/141 [23:29<01:47, 10.74s/it]Evaluating...:  94%|█████████▎| 132/141 [23:40<01:36, 10.74s/it]Evaluating...:  94%|█████████▍| 133/141 [23:51<01:25, 10.74s/it]Evaluating...:  95%|█████████▌| 134/141 [24:01<01:15, 10.75s/it]Evaluating...:  96%|█████████▌| 135/141 [24:12<01:04, 10.80s/it]Evaluating...:  96%|█████████▋| 136/141 [24:23<00:53, 10.78s/it]Evaluating...:  97%|█████████▋| 137/141 [24:34<00:43, 10.77s/it]Evaluating...:  98%|█████████▊| 138/141 [24:44<00:32, 10.76s/it]Evaluating...:  99%|█████████▊| 139/141 [24:55<00:21, 10.75s/it]Evaluating...:  99%|█████████▉| 140/141 [25:06<00:10, 10.79s/it]Evaluating...: 100%|██████████| 141/141 [25:17<00:00, 10.78s/it]Evaluating...: 100%|██████████| 141/141 [25:17<00:00, 10.76s/it]
Perplexity: 13.432821273803711
Running with alpha=0.75
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
W8A8 Quantization.
N:M Sparsity: 2: 4.
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:10,  3.43s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:06<00:06,  3.49s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:10<00:03,  3.46s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:11<00:00,  2.44s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:11<00:00,  2.82s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:102: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:11<25:58, 11.13s/it]Evaluating...:   1%|▏         | 2/141 [00:21<25:20, 10.94s/it]Evaluating...:   2%|▏         | 3/141 [00:32<25:01, 10.88s/it]Evaluating...:   3%|▎         | 4/141 [00:43<24:46, 10.85s/it]Evaluating...:   4%|▎         | 5/141 [00:54<24:31, 10.82s/it]Evaluating...:   4%|▍         | 6/141 [01:05<24:19, 10.81s/it]Evaluating...:   5%|▍         | 7/141 [01:15<24:07, 10.80s/it]Evaluating...:   6%|▌         | 8/141 [01:26<23:56, 10.80s/it]Evaluating...:   6%|▋         | 9/141 [01:37<23:45, 10.80s/it]Evaluating...:   7%|▋         | 10/141 [01:48<23:34, 10.80s/it]Evaluating...:   8%|▊         | 11/141 [01:59<23:23, 10.80s/it]Evaluating...:   9%|▊         | 12/141 [02:09<23:13, 10.80s/it]Evaluating...:   9%|▉         | 13/141 [02:20<23:02, 10.80s/it]Evaluating...:  10%|▉         | 14/141 [02:31<22:52, 10.81s/it]Evaluating...:  11%|█         | 15/141 [02:43<23:10, 11.04s/it]Evaluating...:  11%|█▏        | 16/141 [02:53<22:53, 10.99s/it]Evaluating...:  12%|█▏        | 17/141 [03:04<22:37, 10.95s/it]Evaluating...:  13%|█▎        | 18/141 [03:15<22:21, 10.91s/it]Evaluating...:  13%|█▎        | 19/141 [03:26<22:09, 10.89s/it]Evaluating...:  14%|█▍        | 20/141 [03:37<21:57, 10.89s/it]Evaluating...:  15%|█▍        | 21/141 [03:48<21:46, 10.89s/it]Evaluating...:  16%|█▌        | 22/141 [03:59<21:35, 10.89s/it]Evaluating...:  16%|█▋        | 23/141 [04:09<21:22, 10.87s/it]Evaluating...:  17%|█▋        | 24/141 [04:20<21:13, 10.88s/it]Evaluating...:  18%|█▊        | 25/141 [04:31<21:01, 10.87s/it]Evaluating...:  18%|█▊        | 26/141 [04:42<20:49, 10.86s/it]Evaluating...:  19%|█▉        | 27/141 [04:53<20:36, 10.84s/it]Evaluating...:  20%|█▉        | 28/141 [05:04<20:24, 10.84s/it]Evaluating...:  21%|██        | 29/141 [05:15<20:13, 10.84s/it]Evaluating...:  21%|██▏       | 30/141 [05:25<20:05, 10.86s/it]Evaluating...:  22%|██▏       | 31/141 [05:36<19:53, 10.85s/it]Evaluating...:  23%|██▎       | 32/141 [05:47<19:41, 10.84s/it]Evaluating...:  23%|██▎       | 33/141 [05:58<19:30, 10.84s/it]Evaluating...:  24%|██▍       | 34/141 [06:09<19:21, 10.85s/it]Evaluating...:  25%|██▍       | 35/141 [06:20<19:09, 10.85s/it]Evaluating...:  26%|██▌       | 36/141 [06:30<18:57, 10.83s/it]Evaluating...:  26%|██▌       | 37/141 [06:41<18:45, 10.82s/it]Evaluating...:  27%|██▋       | 38/141 [06:52<18:34, 10.82s/it]Evaluating...:  28%|██▊       | 39/141 [07:03<18:25, 10.84s/it]Evaluating...:  28%|██▊       | 40/141 [07:14<18:14, 10.83s/it]Evaluating...:  29%|██▉       | 41/141 [07:25<18:06, 10.86s/it]Evaluating...:  30%|██▉       | 42/141 [07:36<17:57, 10.88s/it]Evaluating...:  30%|███       | 43/141 [07:46<17:44, 10.87s/it]Evaluating...:  31%|███       | 44/141 [07:57<17:32, 10.86s/it]Evaluating...:  32%|███▏      | 45/141 [08:08<17:23, 10.87s/it]Evaluating...:  33%|███▎      | 46/141 [08:19<17:11, 10.86s/it]Evaluating...:  33%|███▎      | 47/141 [08:30<16:59, 10.85s/it]Evaluating...:  34%|███▍      | 48/141 [08:41<16:48, 10.85s/it]Evaluating...:  35%|███▍      | 49/141 [08:52<16:38, 10.85s/it]Evaluating...:  35%|███▌      | 50/141 [09:02<16:28, 10.86s/it]Evaluating...:  36%|███▌      | 51/141 [09:13<16:17, 10.87s/it]Evaluating...:  37%|███▋      | 52/141 [09:24<16:08, 10.88s/it]Evaluating...:  38%|███▊      | 53/141 [09:35<15:57, 10.88s/it]Evaluating...:  38%|███▊      | 54/141 [09:46<15:46, 10.88s/it]Evaluating...:  39%|███▉      | 55/141 [09:57<15:35, 10.88s/it]Evaluating...:  40%|███▉      | 56/141 [10:08<15:23, 10.86s/it]Evaluating...:  40%|████      | 57/141 [10:18<15:11, 10.85s/it]Evaluating...:  41%|████      | 58/141 [10:29<15:01, 10.86s/it]Evaluating...:  42%|████▏     | 59/141 [10:40<14:50, 10.86s/it]Evaluating...:  43%|████▎     | 60/141 [10:51<14:39, 10.86s/it]Evaluating...:  43%|████▎     | 61/141 [11:02<14:28, 10.86s/it]Evaluating...:  44%|████▍     | 62/141 [11:13<14:18, 10.86s/it]Evaluating...:  45%|████▍     | 63/141 [11:24<14:07, 10.86s/it]Evaluating...:  45%|████▌     | 64/141 [11:35<13:56, 10.86s/it]Evaluating...:  46%|████▌     | 65/141 [11:45<13:44, 10.85s/it]Evaluating...:  47%|████▋     | 66/141 [11:56<13:34, 10.85s/it]Evaluating...:  48%|████▊     | 67/141 [12:07<13:23, 10.86s/it]Evaluating...:  48%|████▊     | 68/141 [12:18<13:13, 10.87s/it]Evaluating...:  49%|████▉     | 69/141 [12:29<13:02, 10.86s/it]Evaluating...:  50%|████▉     | 70/141 [12:40<12:50, 10.86s/it]Evaluating...:  50%|█████     | 71/141 [12:51<12:39, 10.86s/it]Evaluating...:  51%|█████     | 72/141 [13:01<12:28, 10.85s/it]Evaluating...:  52%|█████▏    | 73/141 [13:12<12:17, 10.85s/it]Evaluating...:  52%|█████▏    | 74/141 [13:23<12:07, 10.85s/it]Evaluating...:  53%|█████▎    | 75/141 [13:34<11:57, 10.87s/it]Evaluating...:  54%|█████▍    | 76/141 [13:45<11:47, 10.88s/it]Evaluating...:  55%|█████▍    | 77/141 [13:56<11:36, 10.89s/it]Evaluating...:  55%|█████▌    | 78/141 [14:07<11:26, 10.90s/it]Evaluating...:  56%|█████▌    | 79/141 [14:18<11:15, 10.90s/it]Evaluating...:  57%|█████▋    | 80/141 [14:29<11:05, 10.91s/it]Evaluating...:  57%|█████▋    | 81/141 [14:39<10:54, 10.90s/it]Evaluating...:  58%|█████▊    | 82/141 [14:50<10:43, 10.91s/it]Evaluating...:  59%|█████▉    | 83/141 [15:01<10:32, 10.91s/it]Evaluating...:  60%|█████▉    | 84/141 [15:12<10:22, 10.91s/it]Evaluating...:  60%|██████    | 85/141 [15:23<10:10, 10.91s/it]Evaluating...:  61%|██████    | 86/141 [15:34<09:59, 10.91s/it]Evaluating...:  62%|██████▏   | 87/141 [15:45<09:48, 10.90s/it]Evaluating...:  62%|██████▏   | 88/141 [15:56<09:39, 10.94s/it]Evaluating...:  63%|██████▎   | 89/141 [16:07<09:28, 10.94s/it]Evaluating...:  64%|██████▍   | 90/141 [16:18<09:17, 10.94s/it]Evaluating...:  65%|██████▍   | 91/141 [16:29<09:06, 10.94s/it]Evaluating...:  65%|██████▌   | 92/141 [16:40<08:55, 10.93s/it]Evaluating...:  66%|██████▌   | 93/141 [16:51<08:45, 10.96s/it]Evaluating...:  67%|██████▋   | 94/141 [17:02<08:34, 10.95s/it]Evaluating...:  67%|██████▋   | 95/141 [17:13<08:24, 10.96s/it]Evaluating...:  68%|██████▊   | 96/141 [17:24<08:13, 10.96s/it]Evaluating...:  69%|██████▉   | 97/141 [17:34<08:01, 10.95s/it]Evaluating...:  70%|██████▉   | 98/141 [17:45<07:50, 10.95s/it]Evaluating...:  70%|███████   | 99/141 [17:56<07:40, 10.96s/it]Evaluating...:  71%|███████   | 100/141 [18:07<07:29, 10.96s/it]Evaluating...:  72%|███████▏  | 101/141 [18:18<07:17, 10.95s/it]Evaluating...:  72%|███████▏  | 102/141 [18:29<07:06, 10.95s/it]Evaluating...:  73%|███████▎  | 103/141 [18:40<06:55, 10.94s/it]Evaluating...:  74%|███████▍  | 104/141 [18:51<06:44, 10.93s/it]Evaluating...:  74%|███████▍  | 105/141 [19:02<06:33, 10.92s/it]Evaluating...:  75%|███████▌  | 106/141 [19:13<06:22, 10.93s/it]Evaluating...:  76%|███████▌  | 107/141 [19:24<06:11, 10.93s/it]Evaluating...:  77%|███████▋  | 108/141 [19:35<06:00, 10.93s/it]Evaluating...:  77%|███████▋  | 109/141 [19:46<05:49, 10.93s/it]Evaluating...:  78%|███████▊  | 110/141 [19:57<05:39, 10.94s/it]Evaluating...:  79%|███████▊  | 111/141 [20:08<05:27, 10.93s/it]Evaluating...:  79%|███████▉  | 112/141 [20:18<05:17, 10.93s/it]Evaluating...:  80%|████████  | 113/141 [20:29<05:06, 10.93s/it]Evaluating...:  81%|████████  | 114/141 [20:40<04:55, 10.93s/it]Evaluating...:  82%|████████▏ | 115/141 [20:51<04:44, 10.93s/it]Evaluating...:  82%|████████▏ | 116/141 [21:02<04:33, 10.93s/it]Evaluating...:  83%|████████▎ | 117/141 [21:13<04:22, 10.93s/it]Evaluating...:  84%|████████▎ | 118/141 [21:24<04:11, 10.93s/it]Evaluating...:  84%|████████▍ | 119/141 [21:35<04:00, 10.93s/it]Evaluating...:  85%|████████▌ | 120/141 [21:46<03:49, 10.94s/it]Evaluating...:  86%|████████▌ | 121/141 [21:57<03:38, 10.93s/it]Evaluating...:  87%|████████▋ | 122/141 [22:08<03:27, 10.93s/it]Evaluating...:  87%|████████▋ | 123/141 [22:19<03:16, 10.93s/it]Evaluating...:  88%|████████▊ | 124/141 [22:30<03:05, 10.93s/it]Evaluating...:  89%|████████▊ | 125/141 [22:41<02:54, 10.93s/it]Evaluating...:  89%|████████▉ | 126/141 [22:51<02:43, 10.93s/it]Evaluating...:  90%|█████████ | 127/141 [23:02<02:32, 10.92s/it]Evaluating...:  91%|█████████ | 128/141 [23:13<02:21, 10.90s/it]Evaluating...:  91%|█████████▏| 129/141 [23:24<02:10, 10.87s/it]Evaluating...:  92%|█████████▏| 130/141 [23:35<01:59, 10.85s/it]Evaluating...:  93%|█████████▎| 131/141 [23:46<01:48, 10.89s/it]Evaluating...:  94%|█████████▎| 132/141 [23:57<01:37, 10.88s/it]Evaluating...:  94%|█████████▍| 133/141 [24:08<01:27, 10.89s/it]Evaluating...:  95%|█████████▌| 134/141 [24:19<01:17, 11.11s/it]Evaluating...:  96%|█████████▌| 135/141 [24:31<01:07, 11.24s/it]Evaluating...:  96%|█████████▋| 136/141 [24:42<00:56, 11.31s/it]Evaluating...:  97%|█████████▋| 137/141 [24:54<00:45, 11.36s/it]Evaluating...:  98%|█████████▊| 138/141 [25:05<00:34, 11.35s/it]Evaluating...:  99%|█████████▊| 139/141 [25:17<00:22, 11.41s/it]Evaluating...:  99%|█████████▉| 140/141 [25:28<00:11, 11.46s/it]Evaluating...: 100%|██████████| 141/141 [25:40<00:00, 11.44s/it]Evaluating...: 100%|██████████| 141/141 [25:40<00:00, 10.92s/it]
Perplexity: 13.339937210083008
Running with alpha=0.85
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
W8A8 Quantization.
N:M Sparsity: 2: 4.
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:11,  3.71s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:07<00:07,  3.53s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:10<00:03,  3.50s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:11<00:00,  2.47s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:11<00:00,  2.87s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:102: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:12<28:16, 12.12s/it]Evaluating...:   1%|▏         | 2/141 [00:23<27:26, 11.85s/it]Evaluating...:   2%|▏         | 3/141 [00:35<27:08, 11.80s/it]Evaluating...:   3%|▎         | 4/141 [00:47<26:40, 11.68s/it]Evaluating...:   4%|▎         | 5/141 [00:58<26:27, 11.67s/it]Evaluating...:   4%|▍         | 6/141 [01:10<26:14, 11.66s/it]Evaluating...:   5%|▍         | 7/141 [01:22<26:04, 11.68s/it]Evaluating...:   6%|▌         | 8/141 [01:33<25:56, 11.70s/it]Evaluating...:   6%|▋         | 9/141 [01:45<25:37, 11.65s/it]Evaluating...:   7%|▋         | 10/141 [01:56<25:26, 11.65s/it]Evaluating...:   8%|▊         | 11/141 [02:08<25:09, 11.61s/it]Evaluating...:   9%|▊         | 12/141 [02:20<24:54, 11.58s/it]Evaluating...:   9%|▉         | 13/141 [02:31<24:42, 11.58s/it]Evaluating...:  10%|▉         | 14/141 [02:43<24:38, 11.64s/it]Evaluating...:  11%|█         | 15/141 [02:55<24:28, 11.65s/it]Evaluating...:  11%|█▏        | 16/141 [03:06<24:11, 11.61s/it]Evaluating...:  12%|█▏        | 17/141 [03:18<23:57, 11.59s/it]Evaluating...:  13%|█▎        | 18/141 [03:29<23:45, 11.59s/it]Evaluating...:  13%|█▎        | 19/141 [03:41<23:31, 11.57s/it]Evaluating...:  14%|█▍        | 20/141 [03:52<23:20, 11.57s/it]Evaluating...:  15%|█▍        | 21/141 [04:04<23:08, 11.57s/it]Evaluating...:  16%|█▌        | 22/141 [04:16<23:05, 11.65s/it]Evaluating...:  16%|█▋        | 23/141 [04:27<22:52, 11.63s/it]Evaluating...:  17%|█▋        | 24/141 [04:39<22:48, 11.69s/it]Evaluating...:  18%|█▊        | 25/141 [04:51<22:36, 11.69s/it]Evaluating...:  18%|█▊        | 26/141 [05:02<22:24, 11.69s/it]Evaluating...:  19%|█▉        | 27/141 [05:14<22:12, 11.69s/it]Evaluating...:  20%|█▉        | 28/141 [05:26<21:56, 11.65s/it]Evaluating...:  21%|██        | 29/141 [05:37<21:44, 11.64s/it]Evaluating...:  21%|██▏       | 30/141 [05:49<21:26, 11.59s/it]Evaluating...:  22%|██▏       | 31/141 [06:00<21:13, 11.58s/it]Evaluating...:  23%|██▎       | 32/141 [06:12<21:03, 11.60s/it]Evaluating...:  23%|██▎       | 33/141 [06:24<20:53, 11.60s/it]Evaluating...:  24%|██▍       | 34/141 [06:35<20:49, 11.67s/it]Evaluating...:  25%|██▍       | 35/141 [06:47<20:26, 11.57s/it]Evaluating...:  26%|██▌       | 36/141 [06:58<20:10, 11.52s/it]Evaluating...:  26%|██▌       | 37/141 [07:10<19:51, 11.46s/it]Evaluating...:  27%|██▋       | 38/141 [07:21<19:37, 11.43s/it]Evaluating...:  28%|██▊       | 39/141 [07:32<19:23, 11.41s/it]Evaluating...:  28%|██▊       | 40/141 [07:44<19:11, 11.40s/it]Evaluating...:  29%|██▉       | 41/141 [07:55<18:58, 11.38s/it]Evaluating...:  30%|██▉       | 42/141 [08:06<18:45, 11.37s/it]Evaluating...:  30%|███       | 43/141 [08:18<18:34, 11.37s/it]Evaluating...:  31%|███       | 44/141 [08:29<18:22, 11.36s/it]Evaluating...:  32%|███▏      | 45/141 [08:40<18:10, 11.36s/it]Evaluating...:  33%|███▎      | 46/141 [08:52<17:58, 11.35s/it]Evaluating...:  33%|███▎      | 47/141 [09:03<17:46, 11.35s/it]Evaluating...:  34%|███▍      | 48/141 [09:14<17:34, 11.34s/it]Evaluating...:  35%|███▍      | 49/141 [09:26<17:24, 11.35s/it]Evaluating...:  35%|███▌      | 50/141 [09:37<17:12, 11.34s/it]Evaluating...:  36%|███▌      | 51/141 [09:48<17:00, 11.34s/it]Evaluating...:  37%|███▋      | 52/141 [10:00<16:49, 11.34s/it]Evaluating...:  38%|███▊      | 53/141 [10:11<16:38, 11.35s/it]Evaluating...:  38%|███▊      | 54/141 [10:22<16:23, 11.31s/it]Evaluating...:  39%|███▉      | 55/141 [10:34<16:10, 11.29s/it]Evaluating...:  40%|███▉      | 56/141 [10:45<15:57, 11.27s/it]Evaluating...:  40%|████      | 57/141 [10:56<15:52, 11.34s/it]Evaluating...:  41%|████      | 58/141 [11:08<15:40, 11.34s/it]Evaluating...:  42%|████▏     | 59/141 [11:19<15:24, 11.28s/it]Evaluating...:  43%|████▎     | 60/141 [11:30<15:11, 11.25s/it]Evaluating...:  43%|████▎     | 61/141 [11:41<14:59, 11.24s/it]Evaluating...:  44%|████▍     | 62/141 [11:53<14:51, 11.28s/it]Evaluating...:  45%|████▍     | 63/141 [12:04<14:38, 11.27s/it]Evaluating...:  45%|████▌     | 64/141 [12:15<14:26, 11.25s/it]Evaluating...:  46%|████▌     | 65/141 [12:26<14:14, 11.24s/it]Evaluating...:  47%|████▋     | 66/141 [12:37<14:02, 11.23s/it]Evaluating...:  48%|████▊     | 67/141 [12:49<13:51, 11.23s/it]Evaluating...:  48%|████▊     | 68/141 [13:00<13:41, 11.25s/it]Evaluating...:  49%|████▉     | 69/141 [13:11<13:30, 11.26s/it]Evaluating...:  50%|████▉     | 70/141 [13:23<13:19, 11.26s/it]Evaluating...:  50%|█████     | 71/141 [13:34<13:07, 11.25s/it]Evaluating...:  51%|█████     | 72/141 [13:45<12:54, 11.22s/it]Evaluating...:  52%|█████▏    | 73/141 [13:56<12:41, 11.20s/it]Evaluating...:  52%|█████▏    | 74/141 [14:07<12:30, 11.19s/it]Evaluating...:  53%|█████▎    | 75/141 [14:18<12:18, 11.18s/it]Evaluating...:  54%|█████▍    | 76/141 [14:30<12:06, 11.18s/it]Evaluating...:  55%|█████▍    | 77/141 [14:41<11:55, 11.18s/it]Evaluating...:  55%|█████▌    | 78/141 [14:52<11:44, 11.18s/it]Evaluating...:  56%|█████▌    | 79/141 [15:03<11:33, 11.18s/it]Evaluating...:  57%|█████▋    | 80/141 [15:14<11:22, 11.18s/it]Evaluating...:  57%|█████▋    | 81/141 [15:25<11:10, 11.17s/it]Evaluating...:  58%|█████▊    | 82/141 [15:37<10:59, 11.18s/it]Evaluating...:  59%|█████▉    | 83/141 [15:48<10:47, 11.16s/it]Evaluating...:  60%|█████▉    | 84/141 [15:59<10:36, 11.17s/it]Evaluating...:  60%|██████    | 85/141 [16:10<10:25, 11.18s/it]Evaluating...:  61%|██████    | 86/141 [16:21<10:15, 11.18s/it]Evaluating...:  62%|██████▏   | 87/141 [16:33<10:04, 11.19s/it]Evaluating...:  62%|██████▏   | 88/141 [16:44<09:53, 11.21s/it]Evaluating...:  63%|██████▎   | 89/141 [16:55<09:42, 11.21s/it]Evaluating...:  64%|██████▍   | 90/141 [17:06<09:31, 11.20s/it]Evaluating...:  65%|██████▍   | 91/141 [17:17<09:20, 11.20s/it]Evaluating...:  65%|██████▌   | 92/141 [17:29<09:08, 11.19s/it]Evaluating...:  66%|██████▌   | 93/141 [17:40<08:56, 11.17s/it]Evaluating...:  67%|██████▋   | 94/141 [17:51<08:46, 11.19s/it]Evaluating...:  67%|██████▋   | 95/141 [18:02<08:35, 11.20s/it]Evaluating...:  68%|██████▊   | 96/141 [18:13<08:23, 11.19s/it]Evaluating...:  69%|██████▉   | 97/141 [18:24<08:11, 11.18s/it]Evaluating...:  70%|██████▉   | 98/141 [18:36<08:00, 11.18s/it]Evaluating...:  70%|███████   | 99/141 [18:47<07:49, 11.18s/it]Evaluating...:  71%|███████   | 100/141 [18:58<07:38, 11.19s/it]Evaluating...:  72%|███████▏  | 101/141 [19:09<07:28, 11.21s/it]Evaluating...:  72%|███████▏  | 102/141 [19:20<07:17, 11.21s/it]Evaluating...:  73%|███████▎  | 103/141 [19:32<07:05, 11.20s/it]Evaluating...:  74%|███████▍  | 104/141 [19:43<06:54, 11.20s/it]Evaluating...:  74%|███████▍  | 105/141 [19:54<06:42, 11.18s/it]Evaluating...:  75%|███████▌  | 106/141 [20:05<06:31, 11.17s/it]Evaluating...:  76%|███████▌  | 107/141 [20:16<06:19, 11.17s/it]Evaluating...:  77%|███████▋  | 108/141 [20:28<06:09, 11.19s/it]Evaluating...:  77%|███████▋  | 109/141 [20:39<05:58, 11.19s/it]Evaluating...:  78%|███████▊  | 110/141 [20:50<05:46, 11.18s/it]Evaluating...:  79%|███████▊  | 111/141 [21:01<05:35, 11.17s/it]Evaluating...:  79%|███████▉  | 112/141 [21:12<05:23, 11.17s/it]Evaluating...:  80%|████████  | 113/141 [21:23<05:12, 11.17s/it]Evaluating...:  81%|████████  | 114/141 [21:35<05:01, 11.17s/it]Evaluating...:  82%|████████▏ | 115/141 [21:46<04:50, 11.17s/it]Evaluating...:  82%|████████▏ | 116/141 [21:57<04:38, 11.15s/it]Evaluating...:  83%|████████▎ | 117/141 [22:08<04:27, 11.15s/it]Evaluating...:  84%|████████▎ | 118/141 [22:19<04:17, 11.19s/it]Evaluating...:  84%|████████▍ | 119/141 [22:30<04:05, 11.17s/it]Evaluating...:  85%|████████▌ | 120/141 [22:42<03:54, 11.16s/it]Evaluating...:  86%|████████▌ | 121/141 [22:53<03:43, 11.15s/it]Evaluating...:  87%|████████▋ | 122/141 [23:04<03:32, 11.17s/it]Evaluating...:  87%|████████▋ | 123/141 [23:15<03:21, 11.17s/it]Evaluating...:  88%|████████▊ | 124/141 [23:26<03:09, 11.16s/it]Evaluating...:  89%|████████▊ | 125/141 [23:37<02:58, 11.17s/it]Evaluating...:  89%|████████▉ | 126/141 [23:49<02:47, 11.17s/it]Evaluating...:  90%|█████████ | 127/141 [24:00<02:36, 11.18s/it]Evaluating...:  91%|█████████ | 128/141 [24:11<02:25, 11.18s/it]Evaluating...:  91%|█████████▏| 129/141 [24:22<02:14, 11.24s/it]Evaluating...:  92%|█████████▏| 130/141 [24:33<02:03, 11.21s/it]Evaluating...:  93%|█████████▎| 131/141 [24:45<01:51, 11.19s/it]Evaluating...:  94%|█████████▎| 132/141 [24:56<01:40, 11.15s/it]Evaluating...:  94%|█████████▍| 133/141 [25:07<01:29, 11.16s/it]Evaluating...:  95%|█████████▌| 134/141 [25:18<01:18, 11.18s/it]Evaluating...:  96%|█████████▌| 135/141 [25:29<01:07, 11.17s/it]Evaluating...:  96%|█████████▋| 136/141 [25:40<00:55, 11.18s/it]Evaluating...:  97%|█████████▋| 137/141 [25:52<00:44, 11.20s/it]Evaluating...:  98%|█████████▊| 138/141 [26:03<00:33, 11.20s/it]Evaluating...:  99%|█████████▊| 139/141 [26:14<00:22, 11.19s/it]Evaluating...:  99%|█████████▉| 140/141 [26:25<00:11, 11.17s/it]Evaluating...: 100%|██████████| 141/141 [26:36<00:00, 11.20s/it]Evaluating...: 100%|██████████| 141/141 [26:36<00:00, 11.33s/it]
Perplexity: 13.349512100219727
Running with alpha=0.99
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
W8A8 Quantization.
N:M Sparsity: 2: 4.
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:10,  3.60s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:07<00:07,  3.53s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:10<00:03,  3.50s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:11<00:00,  2.45s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:11<00:00,  2.84s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:102: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:11<26:02, 11.16s/it]Evaluating...:   1%|▏         | 2/141 [00:21<25:08, 10.85s/it]Evaluating...:   2%|▏         | 3/141 [00:32<24:45, 10.76s/it]Evaluating...:   3%|▎         | 4/141 [00:43<24:28, 10.72s/it]Evaluating...:   4%|▎         | 5/141 [00:53<24:13, 10.69s/it]Evaluating...:   4%|▍         | 6/141 [01:04<24:03, 10.69s/it]Evaluating...:   5%|▍         | 7/141 [01:15<23:50, 10.68s/it]Evaluating...:   6%|▌         | 8/141 [01:25<23:39, 10.67s/it]Evaluating...:   6%|▋         | 9/141 [01:36<23:26, 10.66s/it]Evaluating...:   7%|▋         | 10/141 [01:47<23:17, 10.67s/it]Evaluating...:   8%|▊         | 11/141 [01:57<23:06, 10.67s/it]Evaluating...:   9%|▊         | 12/141 [02:08<22:55, 10.66s/it]Evaluating...:   9%|▉         | 13/141 [02:19<22:44, 10.66s/it]Evaluating...:  10%|▉         | 14/141 [02:29<22:35, 10.67s/it]Evaluating...:  11%|█         | 15/141 [02:40<22:22, 10.66s/it]Evaluating...:  11%|█▏        | 16/141 [02:50<22:11, 10.65s/it]Evaluating...:  12%|█▏        | 17/141 [03:01<22:01, 10.65s/it]Evaluating...:  13%|█▎        | 18/141 [03:12<21:51, 10.66s/it]Evaluating...:  13%|█▎        | 19/141 [03:22<21:40, 10.66s/it]Evaluating...:  14%|█▍        | 20/141 [03:33<21:30, 10.66s/it]Evaluating...:  15%|█▍        | 21/141 [03:44<21:24, 10.70s/it]Evaluating...:  16%|█▌        | 22/141 [03:55<21:15, 10.72s/it]Evaluating...:  16%|█▋        | 23/141 [04:06<21:07, 10.75s/it]Evaluating...:  17%|█▋        | 24/141 [04:16<20:57, 10.75s/it]Evaluating...:  18%|█▊        | 25/141 [04:27<20:46, 10.75s/it]Evaluating...:  18%|█▊        | 26/141 [04:38<20:35, 10.74s/it]Evaluating...:  19%|█▉        | 27/141 [04:48<20:24, 10.74s/it]Evaluating...:  20%|█▉        | 28/141 [04:59<20:13, 10.74s/it]Evaluating...:  21%|██        | 29/141 [05:10<20:03, 10.74s/it]Evaluating...:  21%|██▏       | 30/141 [05:21<19:52, 10.74s/it]Evaluating...:  22%|██▏       | 31/141 [05:31<19:40, 10.74s/it]Evaluating...:  23%|██▎       | 32/141 [05:42<19:31, 10.75s/it]Evaluating...:  23%|██▎       | 33/141 [05:53<19:20, 10.75s/it]Evaluating...:  24%|██▍       | 34/141 [06:04<19:11, 10.76s/it]Evaluating...:  25%|██▍       | 35/141 [06:15<19:02, 10.78s/it]Evaluating...:  26%|██▌       | 36/141 [06:25<18:50, 10.77s/it]Evaluating...:  26%|██▌       | 37/141 [06:36<18:39, 10.76s/it]Evaluating...:  27%|██▋       | 38/141 [06:47<18:28, 10.76s/it]Evaluating...:  28%|██▊       | 39/141 [06:58<18:17, 10.76s/it]Evaluating...:  28%|██▊       | 40/141 [07:08<18:06, 10.75s/it]Evaluating...:  29%|██▉       | 41/141 [07:19<17:55, 10.75s/it]Evaluating...:  30%|██▉       | 42/141 [07:30<17:43, 10.74s/it]Evaluating...:  30%|███       | 43/141 [07:41<17:34, 10.76s/it]Evaluating...:  31%|███       | 44/141 [07:51<17:23, 10.76s/it]Evaluating...:  32%|███▏      | 45/141 [08:02<17:12, 10.76s/it]Evaluating...:  33%|███▎      | 46/141 [08:13<17:02, 10.77s/it]Evaluating...:  33%|███▎      | 47/141 [08:24<16:52, 10.77s/it]Evaluating...:  34%|███▍      | 48/141 [08:34<16:41, 10.76s/it]Evaluating...:  35%|███▍      | 49/141 [08:45<16:29, 10.75s/it]Evaluating...:  35%|███▌      | 50/141 [08:56<16:18, 10.75s/it]Evaluating...:  36%|███▌      | 51/141 [09:07<16:07, 10.75s/it]Evaluating...:  37%|███▋      | 52/141 [09:17<15:56, 10.75s/it]Evaluating...:  38%|███▊      | 53/141 [09:28<15:45, 10.75s/it]Evaluating...:  38%|███▊      | 54/141 [09:39<15:35, 10.75s/it]Evaluating...:  39%|███▉      | 55/141 [09:50<15:24, 10.75s/it]Evaluating...:  40%|███▉      | 56/141 [10:00<15:14, 10.75s/it]Evaluating...:  40%|████      | 57/141 [10:11<15:04, 10.77s/it]Evaluating...:  41%|████      | 58/141 [10:22<14:53, 10.77s/it]Evaluating...:  42%|████▏     | 59/141 [10:33<14:43, 10.77s/it]Evaluating...:  43%|████▎     | 60/141 [10:44<14:32, 10.77s/it]Evaluating...:  43%|████▎     | 61/141 [10:54<14:21, 10.77s/it]Evaluating...:  44%|████▍     | 62/141 [11:05<14:11, 10.77s/it]Evaluating...:  45%|████▍     | 63/141 [11:16<13:59, 10.77s/it]Evaluating...:  45%|████▌     | 64/141 [11:27<13:48, 10.76s/it]Evaluating...:  46%|████▌     | 65/141 [11:37<13:37, 10.76s/it]Evaluating...:  47%|████▋     | 66/141 [11:48<13:26, 10.76s/it]Evaluating...:  48%|████▊     | 67/141 [11:59<13:16, 10.77s/it]Evaluating...:  48%|████▊     | 68/141 [12:10<13:04, 10.75s/it]Evaluating...:  49%|████▉     | 69/141 [12:20<12:53, 10.74s/it]Evaluating...:  50%|████▉     | 70/141 [12:31<12:42, 10.74s/it]Evaluating...:  50%|█████     | 71/141 [12:42<12:32, 10.75s/it]Evaluating...:  51%|█████     | 72/141 [12:53<12:22, 10.76s/it]Evaluating...:  52%|█████▏    | 73/141 [13:03<12:11, 10.76s/it]Evaluating...:  52%|█████▏    | 74/141 [13:14<12:01, 10.77s/it]Evaluating...:  53%|█████▎    | 75/141 [13:25<11:50, 10.76s/it]Evaluating...:  54%|█████▍    | 76/141 [13:36<11:40, 10.77s/it]Evaluating...:  55%|█████▍    | 77/141 [13:46<11:29, 10.77s/it]Evaluating...:  55%|█████▌    | 78/141 [13:57<11:18, 10.77s/it]Evaluating...:  56%|█████▌    | 79/141 [14:08<11:07, 10.77s/it]Evaluating...:  57%|█████▋    | 80/141 [14:19<10:57, 10.77s/it]Evaluating...:  57%|█████▋    | 81/141 [14:30<10:46, 10.77s/it]Evaluating...:  58%|█████▊    | 82/141 [14:40<10:35, 10.77s/it]Evaluating...:  59%|█████▉    | 83/141 [14:51<10:24, 10.77s/it]Evaluating...:  60%|█████▉    | 84/141 [15:02<10:13, 10.76s/it]Evaluating...:  60%|██████    | 85/141 [15:13<10:02, 10.75s/it]Evaluating...:  61%|██████    | 86/141 [15:23<09:51, 10.75s/it]Evaluating...:  62%|██████▏   | 87/141 [15:34<09:40, 10.74s/it]Evaluating...:  62%|██████▏   | 88/141 [15:45<09:29, 10.75s/it]Evaluating...:  63%|██████▎   | 89/141 [15:56<09:20, 10.77s/it]Evaluating...:  64%|██████▍   | 90/141 [16:06<09:10, 10.79s/it]Evaluating...:  65%|██████▍   | 91/141 [16:17<08:58, 10.77s/it]Evaluating...:  65%|██████▌   | 92/141 [16:28<08:47, 10.78s/it]Evaluating...:  66%|██████▌   | 93/141 [16:39<08:37, 10.77s/it]Evaluating...:  67%|██████▋   | 94/141 [16:50<08:27, 10.79s/it]Evaluating...:  67%|██████▋   | 95/141 [17:00<08:18, 10.83s/it]Evaluating...:  68%|██████▊   | 96/141 [17:11<08:08, 10.85s/it]Evaluating...:  69%|██████▉   | 97/141 [17:22<07:56, 10.82s/it]Evaluating...:  70%|██████▉   | 98/141 [17:33<07:45, 10.82s/it]Evaluating...:  70%|███████   | 99/141 [17:44<07:33, 10.81s/it]Evaluating...:  71%|███████   | 100/141 [17:54<07:22, 10.80s/it]Evaluating...:  72%|███████▏  | 101/141 [18:05<07:10, 10.77s/it]Evaluating...:  72%|███████▏  | 102/141 [18:16<07:00, 10.77s/it]Evaluating...:  73%|███████▎  | 103/141 [18:27<06:48, 10.76s/it]Evaluating...:  74%|███████▍  | 104/141 [18:37<06:37, 10.75s/it]Evaluating...:  74%|███████▍  | 105/141 [18:48<06:27, 10.75s/it]Evaluating...:  75%|███████▌  | 106/141 [18:59<06:16, 10.75s/it]Evaluating...:  76%|███████▌  | 107/141 [19:10<06:05, 10.75s/it]Evaluating...:  77%|███████▋  | 108/141 [19:20<05:54, 10.75s/it]Evaluating...:  77%|███████▋  | 109/141 [19:31<05:44, 10.75s/it]Evaluating...:  78%|███████▊  | 110/141 [19:42<05:33, 10.76s/it]Evaluating...:  79%|███████▊  | 111/141 [19:53<05:22, 10.76s/it]Evaluating...:  79%|███████▉  | 112/141 [20:03<05:12, 10.76s/it]Evaluating...:  80%|████████  | 113/141 [20:14<05:01, 10.77s/it]Evaluating...:  81%|████████  | 114/141 [20:25<04:50, 10.76s/it]Evaluating...:  82%|████████▏ | 115/141 [20:36<04:40, 10.78s/it]Evaluating...:  82%|████████▏ | 116/141 [20:47<04:29, 10.77s/it]Evaluating...:  83%|████████▎ | 117/141 [20:57<04:18, 10.77s/it]Evaluating...:  84%|████████▎ | 118/141 [21:08<04:07, 10.76s/it]Evaluating...:  84%|████████▍ | 119/141 [21:19<03:57, 10.77s/it]Evaluating...:  85%|████████▌ | 120/141 [21:30<03:46, 10.78s/it]Evaluating...:  86%|████████▌ | 121/141 [21:41<03:35, 10.80s/it]Evaluating...:  87%|████████▋ | 122/141 [21:51<03:25, 10.79s/it]Evaluating...:  87%|████████▋ | 123/141 [22:02<03:14, 10.82s/it]Evaluating...:  88%|████████▊ | 124/141 [22:13<03:03, 10.81s/it]Evaluating...:  89%|████████▊ | 125/141 [22:24<02:53, 10.82s/it]Evaluating...:  89%|████████▉ | 126/141 [22:35<02:42, 10.81s/it]Evaluating...:  90%|█████████ | 127/141 [22:45<02:31, 10.80s/it]Evaluating...:  91%|█████████ | 128/141 [22:56<02:20, 10.80s/it]Evaluating...:  91%|█████████▏| 129/141 [23:07<02:09, 10.79s/it]Evaluating...:  92%|█████████▏| 130/141 [23:18<01:58, 10.78s/it]Evaluating...:  93%|█████████▎| 131/141 [23:28<01:47, 10.77s/it]Evaluating...:  94%|█████████▎| 132/141 [23:39<01:36, 10.76s/it]Evaluating...:  94%|█████████▍| 133/141 [23:50<01:26, 10.76s/it]Evaluating...:  95%|█████████▌| 134/141 [24:01<01:15, 10.75s/it]Evaluating...:  96%|█████████▌| 135/141 [24:11<01:04, 10.75s/it]Evaluating...:  96%|█████████▋| 136/141 [24:22<00:53, 10.75s/it]Evaluating...:  97%|█████████▋| 137/141 [24:33<00:42, 10.73s/it]Evaluating...:  98%|█████████▊| 138/141 [24:44<00:32, 10.73s/it]Evaluating...:  99%|█████████▊| 139/141 [24:54<00:21, 10.72s/it]Evaluating...:  99%|█████████▉| 140/141 [25:05<00:10, 10.71s/it]Evaluating...: 100%|██████████| 141/141 [25:16<00:00, 10.72s/it]Evaluating...: 100%|██████████| 141/141 [25:16<00:00, 10.75s/it]
Perplexity: 13.477035522460938
nohup: ignoring input
========================================
Evaluating with target_modules: lm_head,up_proj,k_proj,v_proj,o_proj,layers.19.self_attn.q_proj,layers.19.mlp.gate_proj,layers.21.self_attn.q_proj,layers.21.mlp.gate_proj,layers.28.self_attn.q_proj,layers.28.mlp.gate_proj,layers.30.self_attn.q_proj,layers.30.mlp.gate_proj,layers.31.self_attn.q_proj,layers.31.mlp.gate_proj
========================================
Running with alpha=0.0
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
W8A8 Quantization.
N:M Sparsity: 2: 4.
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:09,  3.24s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:06<00:06,  3.28s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:09<00:03,  3.14s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.22s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.59s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:117: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:06<14:53,  6.38s/it]Evaluating...:   1%|▏         | 2/141 [00:12<14:25,  6.22s/it]Evaluating...:   2%|▏         | 3/141 [00:18<14:12,  6.18s/it]Evaluating...:   3%|▎         | 4/141 [00:24<14:04,  6.16s/it]Evaluating...:   4%|▎         | 5/141 [00:30<13:55,  6.14s/it]Evaluating...:   4%|▍         | 6/141 [00:36<13:47,  6.13s/it]Evaluating...:   5%|▍         | 7/141 [00:42<13:36,  6.09s/it]Evaluating...:   6%|▌         | 8/141 [00:49<13:30,  6.10s/it]Evaluating...:   6%|▋         | 9/141 [00:55<13:21,  6.07s/it]Evaluating...:   7%|▋         | 10/141 [01:01<13:16,  6.08s/it]Evaluating...:   8%|▊         | 11/141 [01:07<13:11,  6.09s/it]Evaluating...:   9%|▊         | 12/141 [01:13<13:02,  6.07s/it]Evaluating...:   9%|▉         | 13/141 [01:19<12:58,  6.08s/it]Evaluating...:  10%|▉         | 14/141 [01:25<12:50,  6.07s/it]Evaluating...:  11%|█         | 15/141 [01:31<12:42,  6.05s/it]Evaluating...:  11%|█▏        | 16/141 [01:37<12:37,  6.06s/it]Evaluating...:  12%|█▏        | 17/141 [01:43<12:30,  6.05s/it]Evaluating...:  13%|█▎        | 18/141 [01:49<12:26,  6.07s/it]Evaluating...:  13%|█▎        | 19/141 [01:55<12:20,  6.07s/it]Evaluating...:  14%|█▍        | 20/141 [02:01<12:13,  6.06s/it]Evaluating...:  15%|█▍        | 21/141 [02:07<12:09,  6.08s/it]Evaluating...:  16%|█▌        | 22/141 [02:13<12:01,  6.06s/it]Evaluating...:  16%|█▋        | 23/141 [02:20<11:57,  6.08s/it]Evaluating...:  17%|█▋        | 24/141 [02:26<11:51,  6.08s/it]Evaluating...:  18%|█▊        | 25/141 [02:32<11:44,  6.07s/it]Evaluating...:  18%|█▊        | 26/141 [02:38<11:39,  6.08s/it]Evaluating...:  19%|█▉        | 27/141 [02:44<11:35,  6.10s/it]Evaluating...:  20%|█▉        | 28/141 [02:50<11:29,  6.10s/it]Evaluating...:  21%|██        | 29/141 [02:56<11:24,  6.11s/it]Evaluating...:  21%|██▏       | 30/141 [03:02<11:18,  6.11s/it]Evaluating...:  22%|██▏       | 31/141 [03:08<11:13,  6.13s/it]Evaluating...:  23%|██▎       | 32/141 [03:15<11:10,  6.16s/it]Evaluating...:  23%|██▎       | 33/141 [03:21<11:00,  6.12s/it]Evaluating...:  24%|██▍       | 34/141 [03:27<10:57,  6.14s/it]Evaluating...:  25%|██▍       | 35/141 [03:33<10:46,  6.10s/it]Evaluating...:  26%|██▌       | 36/141 [03:39<10:39,  6.09s/it]Evaluating...:  26%|██▌       | 37/141 [03:45<10:31,  6.08s/it]Evaluating...:  27%|██▋       | 38/141 [03:51<10:24,  6.06s/it]Evaluating...:  28%|██▊       | 39/141 [03:57<10:18,  6.06s/it]Evaluating...:  28%|██▊       | 40/141 [04:03<10:10,  6.04s/it]Evaluating...:  29%|██▉       | 41/141 [04:09<10:04,  6.05s/it]Evaluating...:  30%|██▉       | 42/141 [04:15<09:58,  6.05s/it]Evaluating...:  30%|███       | 43/141 [04:21<09:52,  6.05s/it]Evaluating...:  31%|███       | 44/141 [04:27<09:46,  6.05s/it]Evaluating...:  32%|███▏      | 45/141 [04:33<09:40,  6.04s/it]Evaluating...:  33%|███▎      | 46/141 [04:40<09:36,  6.07s/it]Evaluating...:  33%|███▎      | 47/141 [04:46<09:31,  6.08s/it]Evaluating...:  34%|███▍      | 48/141 [04:52<09:23,  6.06s/it]Evaluating...:  35%|███▍      | 49/141 [04:58<09:18,  6.07s/it]Evaluating...:  35%|███▌      | 50/141 [05:04<09:11,  6.06s/it]Evaluating...:  36%|███▌      | 51/141 [05:10<09:05,  6.06s/it]Evaluating...:  37%|███▋      | 52/141 [05:16<08:59,  6.06s/it]Evaluating...:  38%|███▊      | 53/141 [05:22<08:51,  6.05s/it]Evaluating...:  38%|███▊      | 54/141 [05:28<08:46,  6.05s/it]Evaluating...:  39%|███▉      | 55/141 [05:34<08:39,  6.04s/it]Evaluating...:  40%|███▉      | 56/141 [05:40<08:34,  6.05s/it]Evaluating...:  40%|████      | 57/141 [05:46<08:28,  6.05s/it]Evaluating...:  41%|████      | 58/141 [05:52<08:21,  6.04s/it]Evaluating...:  42%|████▏     | 59/141 [05:58<08:16,  6.05s/it]Evaluating...:  43%|████▎     | 60/141 [06:04<08:07,  6.02s/it]Evaluating...:  43%|████▎     | 61/141 [06:10<08:00,  6.00s/it]Evaluating...:  44%|████▍     | 62/141 [06:16<07:53,  5.99s/it]Evaluating...:  45%|████▍     | 63/141 [06:22<07:45,  5.97s/it]Evaluating...:  45%|████▌     | 64/141 [06:28<07:39,  5.97s/it]Evaluating...:  46%|████▌     | 65/141 [06:34<07:32,  5.96s/it]Evaluating...:  47%|████▋     | 66/141 [06:40<07:27,  5.96s/it]Evaluating...:  48%|████▊     | 67/141 [06:46<07:21,  5.96s/it]Evaluating...:  48%|████▊     | 68/141 [06:52<07:14,  5.96s/it]Evaluating...:  49%|████▉     | 69/141 [06:58<07:10,  5.98s/it]Evaluating...:  50%|████▉     | 70/141 [07:04<07:03,  5.96s/it]Evaluating...:  50%|█████     | 71/141 [07:10<06:58,  5.97s/it]Evaluating...:  51%|█████     | 72/141 [07:16<06:52,  5.98s/it]Evaluating...:  52%|█████▏    | 73/141 [07:22<06:45,  5.96s/it]Evaluating...:  52%|█████▏    | 74/141 [07:28<06:41,  6.00s/it]Evaluating...:  53%|█████▎    | 75/141 [07:34<06:34,  5.97s/it]Evaluating...:  54%|█████▍    | 76/141 [07:40<06:28,  5.97s/it]Evaluating...:  55%|█████▍    | 77/141 [07:46<06:21,  5.96s/it]Evaluating...:  55%|█████▌    | 78/141 [07:51<06:15,  5.96s/it]Evaluating...:  56%|█████▌    | 79/141 [07:57<06:09,  5.96s/it]Evaluating...:  57%|█████▋    | 80/141 [08:03<06:03,  5.96s/it]Evaluating...:  57%|█████▋    | 81/141 [08:09<05:57,  5.96s/it]Evaluating...:  58%|█████▊    | 82/141 [08:15<05:51,  5.95s/it]Evaluating...:  59%|█████▉    | 83/141 [08:21<05:45,  5.95s/it]Evaluating...:  60%|█████▉    | 84/141 [08:27<05:41,  5.99s/it]Evaluating...:  60%|██████    | 85/141 [08:33<05:34,  5.97s/it]Evaluating...:  61%|██████    | 86/141 [08:39<05:28,  5.97s/it]Evaluating...:  62%|██████▏   | 87/141 [08:45<05:21,  5.96s/it]Evaluating...:  62%|██████▏   | 88/141 [08:51<05:15,  5.95s/it]Evaluating...:  63%|██████▎   | 89/141 [08:57<05:11,  5.98s/it]Evaluating...:  64%|██████▍   | 90/141 [09:03<05:04,  5.96s/it]Evaluating...:  65%|██████▍   | 91/141 [09:09<04:59,  5.98s/it]Evaluating...:  65%|██████▌   | 92/141 [09:15<04:53,  5.99s/it]Evaluating...:  66%|██████▌   | 93/141 [09:21<04:47,  5.98s/it]Evaluating...:  67%|██████▋   | 94/141 [09:27<04:41,  5.98s/it]Evaluating...:  67%|██████▋   | 95/141 [09:33<04:34,  5.96s/it]Evaluating...:  68%|██████▊   | 96/141 [09:39<04:29,  5.99s/it]Evaluating...:  69%|██████▉   | 97/141 [09:45<04:22,  5.97s/it]Evaluating...:  70%|██████▉   | 98/141 [09:51<04:16,  5.97s/it]Evaluating...:  70%|███████   | 99/141 [09:57<04:10,  5.97s/it]Evaluating...:  71%|███████   | 100/141 [10:03<04:04,  5.96s/it]Evaluating...:  72%|███████▏  | 101/141 [10:09<03:58,  5.96s/it]Evaluating...:  72%|███████▏  | 102/141 [10:15<03:52,  5.97s/it]Evaluating...:  73%|███████▎  | 103/141 [10:21<03:47,  5.99s/it]Evaluating...:  74%|███████▍  | 104/141 [10:27<03:42,  6.01s/it]Evaluating...:  74%|███████▍  | 105/141 [10:33<03:35,  6.00s/it]Evaluating...:  75%|███████▌  | 106/141 [10:39<03:30,  6.02s/it]Evaluating...:  76%|███████▌  | 107/141 [10:45<03:26,  6.07s/it]Evaluating...:  77%|███████▋  | 108/141 [10:51<03:19,  6.05s/it]Evaluating...:  77%|███████▋  | 109/141 [10:57<03:13,  6.04s/it]Evaluating...:  78%|███████▊  | 110/141 [11:03<03:06,  6.01s/it]Evaluating...:  79%|███████▊  | 111/141 [11:09<03:00,  6.02s/it]Evaluating...:  79%|███████▉  | 112/141 [11:15<02:54,  6.02s/it]Evaluating...:  80%|████████  | 113/141 [11:21<02:48,  6.02s/it]Evaluating...:  81%|████████  | 114/141 [11:27<02:43,  6.05s/it]Evaluating...:  82%|████████▏ | 115/141 [11:33<02:36,  6.03s/it]Evaluating...:  82%|████████▏ | 116/141 [11:39<02:31,  6.05s/it]Evaluating...:  83%|████████▎ | 117/141 [11:45<02:25,  6.06s/it]Evaluating...:  84%|████████▎ | 118/141 [11:51<02:19,  6.05s/it]Evaluating...:  84%|████████▍ | 119/141 [11:57<02:12,  6.04s/it]Evaluating...:  85%|████████▌ | 120/141 [12:03<02:06,  6.02s/it]Evaluating...:  86%|████████▌ | 121/141 [12:09<02:00,  6.02s/it]Evaluating...:  87%|████████▋ | 122/141 [12:15<01:54,  6.01s/it]Evaluating...:  87%|████████▋ | 123/141 [12:21<01:48,  6.01s/it]Evaluating...:  88%|████████▊ | 124/141 [12:28<01:42,  6.03s/it]Evaluating...:  89%|████████▊ | 125/141 [12:33<01:36,  6.02s/it]Evaluating...:  89%|████████▉ | 126/141 [12:40<01:30,  6.04s/it]Evaluating...:  90%|█████████ | 127/141 [12:46<01:24,  6.03s/it]Evaluating...:  91%|█████████ | 128/141 [12:52<01:18,  6.02s/it]Evaluating...:  91%|█████████▏| 129/141 [12:58<01:12,  6.02s/it]Evaluating...:  92%|█████████▏| 130/141 [13:04<01:06,  6.01s/it]Evaluating...:  93%|█████████▎| 131/141 [13:10<01:00,  6.02s/it]Evaluating...:  94%|█████████▎| 132/141 [13:16<00:54,  6.03s/it]Evaluating...:  94%|█████████▍| 133/141 [13:22<00:48,  6.02s/it]Evaluating...:  95%|█████████▌| 134/141 [13:28<00:42,  6.05s/it]Evaluating...:  96%|█████████▌| 135/141 [13:34<00:36,  6.03s/it]Evaluating...:  96%|█████████▋| 136/141 [13:40<00:30,  6.06s/it]Evaluating...:  97%|█████████▋| 137/141 [13:46<00:24,  6.06s/it]Evaluating...:  98%|█████████▊| 138/141 [13:52<00:18,  6.05s/it]Evaluating...:  99%|█████████▊| 139/141 [13:58<00:12,  6.12s/it]Evaluating...:  99%|█████████▉| 140/141 [14:04<00:06,  6.10s/it]Evaluating...: 100%|██████████| 141/141 [14:10<00:00,  6.10s/it]Evaluating...: 100%|██████████| 141/141 [14:10<00:00,  6.04s/it]
Perplexity: 7.9684977531433105
Running with alpha=0.15
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
W8A8 Quantization.
N:M Sparsity: 2: 4.
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:01<00:04,  1.52s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:05,  2.58s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:08<00:03,  3.18s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:09<00:00,  2.16s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:09<00:00,  2.33s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:117: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:06<15:50,  6.79s/it]Evaluating...:   1%|▏         | 2/141 [00:13<15:26,  6.66s/it]Evaluating...:   2%|▏         | 3/141 [00:19<15:12,  6.61s/it]Evaluating...:   3%|▎         | 4/141 [00:26<15:02,  6.59s/it]Evaluating...:   4%|▎         | 5/141 [00:33<14:53,  6.57s/it]Evaluating...:   4%|▍         | 6/141 [00:39<14:46,  6.57s/it]Evaluating...:   5%|▍         | 7/141 [00:46<14:40,  6.57s/it]Evaluating...:   6%|▌         | 8/141 [00:52<14:33,  6.57s/it]Evaluating...:   6%|▋         | 9/141 [00:59<14:25,  6.56s/it]Evaluating...:   7%|▋         | 10/141 [01:05<14:18,  6.55s/it]Evaluating...:   8%|▊         | 11/141 [01:12<14:11,  6.55s/it]Evaluating...:   9%|▊         | 12/141 [01:18<14:05,  6.55s/it]Evaluating...:   9%|▉         | 13/141 [01:25<13:58,  6.55s/it]Evaluating...:  10%|▉         | 14/141 [01:32<13:53,  6.56s/it]Evaluating...:  11%|█         | 15/141 [01:38<13:44,  6.54s/it]Evaluating...:  11%|█▏        | 16/141 [01:45<13:36,  6.53s/it]Evaluating...:  12%|█▏        | 17/141 [01:51<13:27,  6.52s/it]Evaluating...:  13%|█▎        | 18/141 [01:58<13:20,  6.51s/it]Evaluating...:  13%|█▎        | 19/141 [02:04<13:14,  6.51s/it]Evaluating...:  14%|█▍        | 20/141 [02:11<13:06,  6.50s/it]Evaluating...:  15%|█▍        | 21/141 [02:17<13:01,  6.51s/it]Evaluating...:  16%|█▌        | 22/141 [02:24<12:56,  6.53s/it]Evaluating...:  16%|█▋        | 23/141 [02:30<12:50,  6.53s/it]Evaluating...:  17%|█▋        | 24/141 [02:37<12:45,  6.54s/it]Evaluating...:  18%|█▊        | 25/141 [02:43<12:40,  6.55s/it]Evaluating...:  18%|█▊        | 26/141 [02:50<12:32,  6.54s/it]Evaluating...:  19%|█▉        | 27/141 [02:56<12:30,  6.58s/it]Evaluating...:  20%|█▉        | 28/141 [03:03<12:23,  6.58s/it]Evaluating...:  21%|██        | 29/141 [03:10<12:16,  6.58s/it]Evaluating...:  21%|██▏       | 30/141 [03:16<12:12,  6.60s/it]Evaluating...:  22%|██▏       | 31/141 [03:23<12:05,  6.59s/it]Evaluating...:  23%|██▎       | 32/141 [03:29<11:56,  6.57s/it]Evaluating...:  23%|██▎       | 33/141 [03:36<11:48,  6.56s/it]Evaluating...:  24%|██▍       | 34/141 [03:42<11:39,  6.53s/it]Evaluating...:  25%|██▍       | 35/141 [03:49<11:29,  6.51s/it]Evaluating...:  26%|██▌       | 36/141 [03:55<11:24,  6.52s/it]Evaluating...:  26%|██▌       | 37/141 [04:02<11:16,  6.51s/it]Evaluating...:  27%|██▋       | 38/141 [04:08<11:13,  6.54s/it]Evaluating...:  28%|██▊       | 39/141 [04:15<11:08,  6.56s/it]Evaluating...:  28%|██▊       | 40/141 [04:22<11:01,  6.55s/it]Evaluating...:  29%|██▉       | 41/141 [04:28<10:55,  6.56s/it]Evaluating...:  30%|██▉       | 42/141 [04:35<10:50,  6.57s/it]Evaluating...:  30%|███       | 43/141 [04:41<10:43,  6.56s/it]Evaluating...:  31%|███       | 44/141 [04:48<10:37,  6.57s/it]Evaluating...:  32%|███▏      | 45/141 [04:55<10:32,  6.59s/it]Evaluating...:  33%|███▎      | 46/141 [05:01<10:25,  6.58s/it]Evaluating...:  33%|███▎      | 47/141 [05:08<10:18,  6.58s/it]Evaluating...:  34%|███▍      | 48/141 [05:14<10:14,  6.61s/it]Evaluating...:  35%|███▍      | 49/141 [05:21<10:06,  6.59s/it]Evaluating...:  35%|███▌      | 50/141 [05:27<09:58,  6.57s/it]Evaluating...:  36%|███▌      | 51/141 [05:34<09:50,  6.57s/it]Evaluating...:  37%|███▋      | 52/141 [05:41<09:43,  6.56s/it]Evaluating...:  38%|███▊      | 53/141 [05:47<09:37,  6.56s/it]Evaluating...:  38%|███▊      | 54/141 [05:54<09:30,  6.56s/it]Evaluating...:  39%|███▉      | 55/141 [06:00<09:22,  6.54s/it]Evaluating...:  40%|███▉      | 56/141 [06:07<09:16,  6.55s/it]Evaluating...:  40%|████      | 57/141 [06:13<09:09,  6.55s/it]Evaluating...:  41%|████      | 58/141 [06:20<09:02,  6.53s/it]Evaluating...:  42%|████▏     | 59/141 [06:26<08:56,  6.54s/it]Evaluating...:  43%|████▎     | 60/141 [06:33<08:50,  6.55s/it]Evaluating...:  43%|████▎     | 61/141 [06:39<08:43,  6.54s/it]Evaluating...:  44%|████▍     | 62/141 [06:46<08:38,  6.56s/it]Evaluating...:  45%|████▍     | 63/141 [06:53<08:32,  6.57s/it]Evaluating...:  45%|████▌     | 64/141 [06:59<08:24,  6.55s/it]Evaluating...:  46%|████▌     | 65/141 [07:06<08:17,  6.55s/it]Evaluating...:  47%|████▋     | 66/141 [07:12<08:10,  6.54s/it]Evaluating...:  48%|████▊     | 67/141 [07:19<08:03,  6.53s/it]Evaluating...:  48%|████▊     | 68/141 [07:25<07:58,  6.55s/it]Evaluating...:  49%|████▉     | 69/141 [07:32<07:53,  6.57s/it]Evaluating...:  50%|████▉     | 70/141 [07:38<07:46,  6.57s/it]Evaluating...:  50%|█████     | 71/141 [07:45<07:42,  6.60s/it]Evaluating...:  51%|█████     | 72/141 [07:52<07:34,  6.58s/it]Evaluating...:  52%|█████▏    | 73/141 [07:58<07:28,  6.59s/it]Evaluating...:  52%|█████▏    | 74/141 [08:05<07:23,  6.61s/it]Evaluating...:  53%|█████▎    | 75/141 [08:11<07:15,  6.59s/it]Evaluating...:  54%|█████▍    | 76/141 [08:18<07:07,  6.58s/it]Evaluating...:  55%|█████▍    | 77/141 [08:25<07:00,  6.57s/it]Evaluating...:  55%|█████▌    | 78/141 [08:31<06:53,  6.56s/it]Evaluating...:  56%|█████▌    | 79/141 [08:38<06:46,  6.55s/it]Evaluating...:  57%|█████▋    | 80/141 [08:44<06:40,  6.56s/it]Evaluating...:  57%|█████▋    | 81/141 [08:51<06:32,  6.54s/it]Evaluating...:  58%|█████▊    | 82/141 [08:57<06:26,  6.54s/it]Evaluating...:  59%|█████▉    | 83/141 [09:04<06:19,  6.55s/it]Evaluating...:  60%|█████▉    | 84/141 [09:10<06:12,  6.54s/it]Evaluating...:  60%|██████    | 85/141 [09:17<06:06,  6.54s/it]Evaluating...:  61%|██████    | 86/141 [09:23<05:59,  6.54s/it]Evaluating...:  62%|██████▏   | 87/141 [09:30<05:52,  6.53s/it]Evaluating...:  62%|██████▏   | 88/141 [09:37<05:46,  6.53s/it]Evaluating...:  63%|██████▎   | 89/141 [09:43<05:39,  6.54s/it]Evaluating...:  64%|██████▍   | 90/141 [09:50<05:32,  6.53s/it]Evaluating...:  65%|██████▍   | 91/141 [09:56<05:26,  6.54s/it]Evaluating...:  65%|██████▌   | 92/141 [10:03<05:20,  6.54s/it]Evaluating...:  66%|██████▌   | 93/141 [10:09<05:13,  6.54s/it]Evaluating...:  67%|██████▋   | 94/141 [10:16<05:07,  6.54s/it]Evaluating...:  67%|██████▋   | 95/141 [10:22<05:00,  6.54s/it]Evaluating...:  68%|██████▊   | 96/141 [10:29<04:54,  6.53s/it]Evaluating...:  69%|██████▉   | 97/141 [10:35<04:47,  6.54s/it]Evaluating...:  70%|██████▉   | 98/141 [10:42<04:41,  6.55s/it]Evaluating...:  70%|███████   | 99/141 [10:48<04:34,  6.53s/it]Evaluating...:  71%|███████   | 100/141 [10:55<04:27,  6.54s/it]Evaluating...:  72%|███████▏  | 101/141 [11:01<04:20,  6.51s/it]Evaluating...:  72%|███████▏  | 102/141 [11:08<04:13,  6.51s/it]Evaluating...:  73%|███████▎  | 103/141 [11:14<04:07,  6.51s/it]Evaluating...:  74%|███████▍  | 104/141 [11:21<04:00,  6.50s/it]Evaluating...:  74%|███████▍  | 105/141 [11:27<03:54,  6.51s/it]Evaluating...:  75%|███████▌  | 106/141 [11:34<03:48,  6.52s/it]Evaluating...:  76%|███████▌  | 107/141 [11:40<03:40,  6.50s/it]Evaluating...:  77%|███████▋  | 108/141 [11:47<03:34,  6.49s/it]Evaluating...:  77%|███████▋  | 109/141 [11:53<03:27,  6.49s/it]Evaluating...:  78%|███████▊  | 110/141 [12:00<03:20,  6.48s/it]Evaluating...:  79%|███████▊  | 111/141 [12:06<03:14,  6.48s/it]Evaluating...:  79%|███████▉  | 112/141 [12:13<03:08,  6.49s/it]Evaluating...:  80%|████████  | 113/141 [12:19<03:02,  6.51s/it]Evaluating...:  81%|████████  | 114/141 [12:26<02:56,  6.55s/it]Evaluating...:  82%|████████▏ | 115/141 [12:33<02:50,  6.55s/it]Evaluating...:  82%|████████▏ | 116/141 [12:39<02:43,  6.55s/it]Evaluating...:  83%|████████▎ | 117/141 [12:46<02:37,  6.57s/it]Evaluating...:  84%|████████▎ | 118/141 [12:52<02:31,  6.58s/it]Evaluating...:  84%|████████▍ | 119/141 [12:59<02:24,  6.56s/it]Evaluating...:  85%|████████▌ | 120/141 [13:05<02:17,  6.55s/it]Evaluating...:  86%|████████▌ | 121/141 [13:12<02:10,  6.54s/it]Evaluating...:  87%|████████▋ | 122/141 [13:18<02:04,  6.54s/it]Evaluating...:  87%|████████▋ | 123/141 [13:25<01:57,  6.54s/it]Evaluating...:  88%|████████▊ | 124/141 [13:32<01:51,  6.53s/it]Evaluating...:  89%|████████▊ | 125/141 [13:38<01:44,  6.53s/it]Evaluating...:  89%|████████▉ | 126/141 [13:45<01:38,  6.54s/it]Evaluating...:  90%|█████████ | 127/141 [13:51<01:31,  6.53s/it]Evaluating...:  91%|█████████ | 128/141 [13:58<01:24,  6.53s/it]Evaluating...:  91%|█████████▏| 129/141 [14:04<01:18,  6.55s/it]Evaluating...:  92%|█████████▏| 130/141 [14:11<01:11,  6.54s/it]Evaluating...:  93%|█████████▎| 131/141 [14:17<01:05,  6.56s/it]Evaluating...:  94%|█████████▎| 132/141 [14:24<00:59,  6.57s/it]Evaluating...:  94%|█████████▍| 133/141 [14:30<00:52,  6.54s/it]Evaluating...:  95%|█████████▌| 134/141 [14:37<00:45,  6.56s/it]Evaluating...:  96%|█████████▌| 135/141 [14:44<00:39,  6.57s/it]Evaluating...:  96%|█████████▋| 136/141 [14:50<00:32,  6.55s/it]Evaluating...:  97%|█████████▋| 137/141 [14:57<00:26,  6.55s/it]Evaluating...:  98%|█████████▊| 138/141 [15:03<00:19,  6.56s/it]Evaluating...:  99%|█████████▊| 139/141 [15:10<00:13,  6.56s/it]Evaluating...:  99%|█████████▉| 140/141 [15:16<00:06,  6.55s/it]Evaluating...: 100%|██████████| 141/141 [15:23<00:00,  6.55s/it]Evaluating...: 100%|██████████| 141/141 [15:23<00:00,  6.55s/it]
Perplexity: 7.810176849365234
Running with alpha=0.25
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
W8A8 Quantization.
N:M Sparsity: 2: 4.
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:10,  3.59s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:07<00:07,  3.59s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:10<00:03,  3.44s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:11<00:00,  2.42s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:11<00:00,  2.83s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:117: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:06<14:27,  6.19s/it]Evaluating...:   1%|▏         | 2/141 [00:12<13:56,  6.02s/it]Evaluating...:   2%|▏         | 3/141 [00:18<13:46,  5.99s/it]Evaluating...:   3%|▎         | 4/141 [00:23<13:34,  5.94s/it]Evaluating...:   4%|▎         | 5/141 [00:29<13:28,  5.94s/it]Evaluating...:   4%|▍         | 6/141 [00:35<13:19,  5.92s/it]Evaluating...:   5%|▍         | 7/141 [00:41<13:10,  5.90s/it]Evaluating...:   6%|▌         | 8/141 [00:47<13:03,  5.89s/it]Evaluating...:   6%|▋         | 9/141 [00:53<12:56,  5.88s/it]Evaluating...:   7%|▋         | 10/141 [00:59<12:53,  5.91s/it]Evaluating...:   8%|▊         | 11/141 [01:05<12:47,  5.90s/it]Evaluating...:   9%|▊         | 12/141 [01:11<12:41,  5.90s/it]Evaluating...:   9%|▉         | 13/141 [01:16<12:34,  5.90s/it]Evaluating...:  10%|▉         | 14/141 [01:22<12:28,  5.89s/it]Evaluating...:  11%|█         | 15/141 [01:28<12:21,  5.88s/it]Evaluating...:  11%|█▏        | 16/141 [01:34<12:15,  5.88s/it]Evaluating...:  12%|█▏        | 17/141 [01:40<12:10,  5.89s/it]Evaluating...:  13%|█▎        | 18/141 [01:46<12:04,  5.89s/it]Evaluating...:  13%|█▎        | 19/141 [01:52<11:58,  5.89s/it]Evaluating...:  14%|█▍        | 20/141 [01:58<11:54,  5.90s/it]Evaluating...:  15%|█▍        | 21/141 [02:04<11:47,  5.90s/it]Evaluating...:  16%|█▌        | 22/141 [02:10<11:42,  5.90s/it]Evaluating...:  16%|█▋        | 23/141 [02:15<11:37,  5.91s/it]Evaluating...:  17%|█▋        | 24/141 [02:21<11:30,  5.90s/it]Evaluating...:  18%|█▊        | 25/141 [02:27<11:25,  5.91s/it]Evaluating...:  18%|█▊        | 26/141 [02:33<11:18,  5.90s/it]Evaluating...:  19%|█▉        | 27/141 [02:39<11:13,  5.91s/it]Evaluating...:  20%|█▉        | 28/141 [02:45<11:07,  5.90s/it]Evaluating...:  21%|██        | 29/141 [02:51<11:01,  5.90s/it]Evaluating...:  21%|██▏       | 30/141 [02:57<10:55,  5.91s/it]Evaluating...:  22%|██▏       | 31/141 [03:03<10:48,  5.89s/it]Evaluating...:  23%|██▎       | 32/141 [03:09<10:42,  5.89s/it]Evaluating...:  23%|██▎       | 33/141 [03:14<10:35,  5.89s/it]Evaluating...:  24%|██▍       | 34/141 [03:20<10:30,  5.89s/it]Evaluating...:  25%|██▍       | 35/141 [03:26<10:23,  5.88s/it]Evaluating...:  26%|██▌       | 36/141 [03:32<10:17,  5.88s/it]Evaluating...:  26%|██▌       | 37/141 [03:38<10:13,  5.90s/it]Evaluating...:  27%|██▋       | 38/141 [03:44<10:06,  5.89s/it]Evaluating...:  28%|██▊       | 39/141 [03:50<10:03,  5.91s/it]Evaluating...:  28%|██▊       | 40/141 [03:56<09:57,  5.92s/it]Evaluating...:  29%|██▉       | 41/141 [04:02<09:50,  5.91s/it]Evaluating...:  30%|██▉       | 42/141 [04:08<09:47,  5.94s/it]Evaluating...:  30%|███       | 43/141 [04:13<09:39,  5.91s/it]Evaluating...:  31%|███       | 44/141 [04:19<09:32,  5.90s/it]Evaluating...:  32%|███▏      | 45/141 [04:25<09:26,  5.90s/it]Evaluating...:  33%|███▎      | 46/141 [04:31<09:19,  5.89s/it]Evaluating...:  33%|███▎      | 47/141 [04:37<09:15,  5.91s/it]Evaluating...:  34%|███▍      | 48/141 [04:43<09:08,  5.89s/it]Evaluating...:  35%|███▍      | 49/141 [04:49<09:04,  5.92s/it]Evaluating...:  35%|███▌      | 50/141 [04:55<09:00,  5.93s/it]Evaluating...:  36%|███▌      | 51/141 [05:01<08:54,  5.94s/it]Evaluating...:  37%|███▋      | 52/141 [05:07<08:49,  5.95s/it]Evaluating...:  38%|███▊      | 53/141 [05:13<08:42,  5.93s/it]Evaluating...:  38%|███▊      | 54/141 [05:19<08:38,  5.96s/it]Evaluating...:  39%|███▉      | 55/141 [05:25<08:31,  5.95s/it]Evaluating...:  40%|███▉      | 56/141 [05:31<08:24,  5.94s/it]Evaluating...:  40%|████      | 57/141 [05:36<08:17,  5.92s/it]Evaluating...:  41%|████      | 58/141 [05:42<08:10,  5.91s/it]Evaluating...:  42%|████▏     | 59/141 [05:48<08:03,  5.89s/it]Evaluating...:  43%|████▎     | 60/141 [05:54<07:56,  5.89s/it]Evaluating...:  43%|████▎     | 61/141 [06:00<07:51,  5.89s/it]Evaluating...:  44%|████▍     | 62/141 [06:06<07:45,  5.89s/it]Evaluating...:  45%|████▍     | 63/141 [06:12<07:39,  5.89s/it]Evaluating...:  45%|████▌     | 64/141 [06:18<07:33,  5.89s/it]Evaluating...:  46%|████▌     | 65/141 [06:23<07:27,  5.88s/it]Evaluating...:  47%|████▋     | 66/141 [06:29<07:22,  5.90s/it]Evaluating...:  48%|████▊     | 67/141 [06:35<07:15,  5.89s/it]Evaluating...:  48%|████▊     | 68/141 [06:41<07:09,  5.89s/it]Evaluating...:  49%|████▉     | 69/141 [06:47<07:03,  5.88s/it]Evaluating...:  50%|████▉     | 70/141 [06:53<06:57,  5.89s/it]Evaluating...:  50%|█████     | 71/141 [06:59<06:52,  5.89s/it]Evaluating...:  51%|█████     | 72/141 [07:05<06:46,  5.89s/it]Evaluating...:  52%|█████▏    | 73/141 [07:11<06:40,  5.89s/it]Evaluating...:  52%|█████▏    | 74/141 [07:17<06:35,  5.90s/it]Evaluating...:  53%|█████▎    | 75/141 [07:22<06:29,  5.90s/it]Evaluating...:  54%|█████▍    | 76/141 [07:28<06:23,  5.90s/it]Evaluating...:  55%|█████▍    | 77/141 [07:34<06:16,  5.89s/it]Evaluating...:  55%|█████▌    | 78/141 [07:40<06:11,  5.89s/it]Evaluating...:  56%|█████▌    | 79/141 [07:46<06:05,  5.89s/it]Evaluating...:  57%|█████▋    | 80/141 [07:52<05:59,  5.89s/it]Evaluating...:  57%|█████▋    | 81/141 [07:58<05:53,  5.90s/it]Evaluating...:  58%|█████▊    | 82/141 [08:04<05:47,  5.88s/it]Evaluating...:  59%|█████▉    | 83/141 [08:10<05:41,  5.89s/it]Evaluating...:  60%|█████▉    | 84/141 [08:15<05:36,  5.90s/it]Evaluating...:  60%|██████    | 85/141 [08:22<05:43,  6.14s/it]Evaluating...:  61%|██████    | 86/141 [08:28<05:40,  6.19s/it]Evaluating...:  62%|██████▏   | 87/141 [08:35<05:35,  6.22s/it]Evaluating...:  62%|██████▏   | 88/141 [08:41<05:29,  6.21s/it]Evaluating...:  63%|██████▎   | 89/141 [08:47<05:23,  6.22s/it]Evaluating...:  64%|██████▍   | 90/141 [08:53<05:17,  6.23s/it]Evaluating...:  65%|██████▍   | 91/141 [09:00<05:12,  6.25s/it]Evaluating...:  65%|██████▌   | 92/141 [09:06<05:06,  6.26s/it]Evaluating...:  66%|██████▌   | 93/141 [09:12<04:59,  6.24s/it]Evaluating...:  67%|██████▋   | 94/141 [09:18<04:52,  6.22s/it]Evaluating...:  67%|██████▋   | 95/141 [09:25<04:44,  6.19s/it]Evaluating...:  68%|██████▊   | 96/141 [09:31<04:38,  6.20s/it]Evaluating...:  69%|██████▉   | 97/141 [09:37<04:34,  6.23s/it]Evaluating...:  70%|██████▉   | 98/141 [09:43<04:28,  6.25s/it]Evaluating...:  70%|███████   | 99/141 [09:50<04:22,  6.24s/it]Evaluating...:  71%|███████   | 100/141 [09:56<04:14,  6.22s/it]Evaluating...:  72%|███████▏  | 101/141 [10:02<04:08,  6.20s/it]Evaluating...:  72%|███████▏  | 102/141 [10:08<04:00,  6.18s/it]Evaluating...:  73%|███████▎  | 103/141 [10:14<03:55,  6.20s/it]Evaluating...:  74%|███████▍  | 104/141 [10:20<03:48,  6.19s/it]Evaluating...:  74%|███████▍  | 105/141 [10:27<03:42,  6.18s/it]Evaluating...:  75%|███████▌  | 106/141 [10:33<03:36,  6.20s/it]Evaluating...:  76%|███████▌  | 107/141 [10:39<03:32,  6.26s/it]Evaluating...:  77%|███████▋  | 108/141 [10:45<03:25,  6.24s/it]Evaluating...:  77%|███████▋  | 109/141 [10:52<03:19,  6.23s/it]Evaluating...:  78%|███████▊  | 110/141 [10:58<03:13,  6.25s/it]Evaluating...:  79%|███████▊  | 111/141 [11:04<03:06,  6.21s/it]Evaluating...:  79%|███████▉  | 112/141 [11:10<03:01,  6.24s/it]Evaluating...:  80%|████████  | 113/141 [11:17<02:55,  6.28s/it]Evaluating...:  81%|████████  | 114/141 [11:23<02:50,  6.33s/it]Evaluating...:  82%|████████▏ | 115/141 [11:30<02:45,  6.36s/it]Evaluating...:  82%|████████▏ | 116/141 [11:36<02:39,  6.38s/it]Evaluating...:  83%|████████▎ | 117/141 [11:42<02:33,  6.40s/it]Evaluating...:  84%|████████▎ | 118/141 [11:49<02:27,  6.42s/it]Evaluating...:  84%|████████▍ | 119/141 [11:55<02:21,  6.45s/it]Evaluating...:  85%|████████▌ | 120/141 [12:02<02:15,  6.45s/it]Evaluating...:  86%|████████▌ | 121/141 [12:08<02:08,  6.45s/it]Evaluating...:  87%|████████▋ | 122/141 [12:15<02:02,  6.46s/it]Evaluating...:  87%|████████▋ | 123/141 [12:21<01:55,  6.44s/it]Evaluating...:  88%|████████▊ | 124/141 [12:28<01:49,  6.47s/it]Evaluating...:  89%|████████▊ | 125/141 [12:34<01:42,  6.41s/it]Evaluating...:  89%|████████▉ | 126/141 [12:40<01:35,  6.39s/it]Evaluating...:  90%|█████████ | 127/141 [12:47<01:29,  6.39s/it]Evaluating...:  91%|█████████ | 128/141 [12:53<01:23,  6.39s/it]Evaluating...:  91%|█████████▏| 129/141 [13:00<01:16,  6.41s/it]Evaluating...:  92%|█████████▏| 130/141 [13:06<01:10,  6.43s/it]Evaluating...:  93%|█████████▎| 131/141 [13:12<01:04,  6.42s/it]Evaluating...:  94%|█████████▎| 132/141 [13:19<00:57,  6.41s/it]Evaluating...:  94%|█████████▍| 133/141 [13:25<00:51,  6.42s/it]Evaluating...:  95%|█████████▌| 134/141 [13:32<00:44,  6.38s/it]Evaluating...:  96%|█████████▌| 135/141 [13:38<00:38,  6.39s/it]Evaluating...:  96%|█████████▋| 136/141 [13:44<00:31,  6.39s/it]Evaluating...:  97%|█████████▋| 137/141 [13:51<00:25,  6.39s/it]Evaluating...:  98%|█████████▊| 138/141 [13:57<00:19,  6.37s/it]Evaluating...:  99%|█████████▊| 139/141 [14:04<00:12,  6.41s/it]Evaluating...:  99%|█████████▉| 140/141 [14:10<00:06,  6.39s/it]Evaluating...: 100%|██████████| 141/141 [14:16<00:00,  6.39s/it]Evaluating...: 100%|██████████| 141/141 [14:16<00:00,  6.08s/it]
Perplexity: 7.803749084472656
Running with alpha=0.5
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
W8A8 Quantization.
N:M Sparsity: 2: 4.
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:09,  3.25s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:06<00:06,  3.35s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:09<00:03,  3.21s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.26s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.63s/it]
/gemini/code/NMSparsity/smoothquant/smoothquant/ppl_eval.py:125: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  act_scales = torch.load(act_scales_path)
smooth...
quantize...
Evaluating...:   0%|          | 0/141 [00:00<?, ?it/s]Evaluating...:   1%|          | 1/141 [00:06<14:44,  6.32s/it]Evaluating...:   1%|▏         | 2/141 [00:12<14:02,  6.06s/it]Evaluating...:   2%|▏         | 3/141 [00:18<13:54,  6.05s/it]Evaluating...:   3%|▎         | 4/141 [00:24<13:51,  6.07s/it]Evaluating...:   4%|▎         | 5/141 [00:30<13:40,  6.04s/it]Evaluating...:   4%|▍         | 6/141 [00:36<13:38,  6.07s/it]Evaluating...:   5%|▍         | 7/141 [00:42<13:30,  6.04s/it]Evaluating...:   6%|▌         | 8/141 [00:48<13:31,  6.10s/it]Evaluating...:   6%|▋         | 9/141 [00:54<13:21,  6.07s/it]Evaluating...:   7%|▋         | 10/141 [01:00<13:16,  6.08s/it]Evaluating...:   8%|▊         | 11/141 [01:06<13:07,  6.05s/it]Evaluating...:   9%|▊         | 12/141 [01:12<12:59,  6.04s/it]Evaluating...:   9%|▉         | 13/141 [01:18<12:52,  6.04s/it]Evaluating...:  10%|▉         | 14/141 [01:24<12:51,  6.07s/it]Evaluating...:  11%|█         | 15/141 [01:30<12:40,  6.03s/it]Evaluating...:  11%|█▏        | 16/141 [01:36<12:34,  6.04s/it]Evaluating...:  12%|█▏        | 17/141 [01:42<12:27,  6.03s/it]Evaluating...:  13%|█▎        | 18/141 [01:48<12:19,  6.01s/it]Evaluating...:  13%|█▎        | 19/141 [01:54<12:13,  6.01s/it]Evaluating...:  14%|█▍        | 20/141 [02:00<12:06,  6.01s/it]Evaluating...:  15%|█▍        | 21/141 [02:06<12:00,  6.00s/it]Evaluating...:  16%|█▌        | 22/141 [02:12<11:51,  5.98s/it]Evaluating...:  16%|█▋        | 23/141 [02:18<11:47,  6.00s/it]Evaluating...:  17%|█▋        | 24/141 [02:24<11:40,  5.99s/it]Evaluating...:  18%|█▊        | 25/141 [02:30<11:35,  5.99s/it]Evaluating...:  18%|█▊        | 26/141 [02:36<11:31,  6.01s/it]Evaluating...:  19%|█▉        | 27/141 [02:43<11:29,  6.05s/it]Evaluating...:  20%|█▉        | 28/141 [02:49<11:21,  6.03s/it]Evaluating...:  21%|██        | 29/141 [02:54<11:09,  5.97s/it]Evaluating...:  21%|██▏       | 30/141 [03:00<11:00,  5.95s/it]Evaluating...:  22%|██▏       | 31/141 [03:06<10:51,  5.92s/it]Evaluating...:  23%|██▎       | 32/141 [03:12<10:42,  5.90s/it]Evaluating...:  23%|██▎       | 33/141 [03:18<10:35,  5.88s/it]Evaluating...:  24%|██▍       | 34/141 [03:24<10:27,  5.86s/it]Evaluating...:  25%|██▍       | 35/141 [03:29<10:20,  5.86s/it]Evaluating...:  26%|██▌       | 36/141 [03:35<10:13,  5.85s/it]Evaluating...:  26%|██▌       | 37/141 [03:41<10:08,  5.85s/it]Evaluating...:  27%|██▋       | 38/141 [03:47<10:02,  5.85s/it]Evaluating...:  28%|██▊       | 39/141 [03:53<09:56,  5.84s/it]Evaluating...:  28%|██▊       | 40/141 [03:59<09:53,  5.87s/it]Evaluating...:  29%|██▉       | 41/141 [04:05<09:46,  5.86s/it]Evaluating...:  30%|██▉       | 42/141 [04:11<09:41,  5.87s/it]Evaluating...:  30%|███       | 43/141 [04:16<09:36,  5.88s/it]Evaluating...:  31%|███       | 44/141 [04:22<09:29,  5.87s/it]Evaluating...:  32%|███▏      | 45/141 [04:28<09:25,  5.89s/it]Evaluating...:  33%|███▎      | 46/141 [04:34<09:18,  5.88s/it]Evaluating...:  33%|███▎      | 47/141 [04:40<09:11,  5.87s/it]Evaluating...:  34%|███▍      | 48/141 [04:46<09:04,  5.86s/it]Evaluating...:  35%|███▍      | 49/141 [04:52<08:57,  5.84s/it]Evaluating...:  35%|███▌      | 50/141 [04:57<08:51,  5.84s/it]Evaluating...:  36%|███▌      | 51/141 [05:03<08:45,  5.84s/it]Evaluating...:  37%|███▋      | 52/141 [05:09<08:39,  5.84s/it]Evaluating...:  38%|███▊      | 53/141 [05:15<08:33,  5.83s/it]Evaluating...:  38%|███▊      | 54/141 [05:21<08:28,  5.85s/it]Evaluating...:  39%|███▉      | 55/141 [05:27<08:22,  5.84s/it]Evaluating...:  40%|███▉      | 56/141 [05:32<08:16,  5.84s/it]Evaluating...:  40%|████      | 57/141 [05:38<08:09,  5.83s/it]Evaluating...:  41%|████      | 58/141 [05:44<08:03,  5.83s/it]Evaluating...:  42%|████▏     | 59/141 [05:50<07:58,  5.84s/it]Evaluating...:  43%|████▎     | 60/141 [05:56<07:52,  5.84s/it]Evaluating...:  43%|████▎     | 61/141 [06:02<07:46,  5.84s/it]Evaluating...:  44%|████▍     | 62/141 [06:07<07:40,  5.83s/it]Evaluating...:  45%|████▍     | 63/141 [06:13<07:34,  5.83s/it]Evaluating...:  45%|████▌     | 64/141 [06:19<07:28,  5.83s/it]Evaluating...:  46%|████▌     | 65/141 [06:25<07:22,  5.83s/it]Evaluating...:  47%|████▋     | 66/141 [06:31<07:17,  5.83s/it]Evaluating...:  48%|████▊     | 67/141 [06:37<07:12,  5.84s/it]Evaluating...:  48%|████▊     | 68/141 [06:42<07:07,  5.85s/it]Evaluating...:  49%|████▉     | 69/141 [06:48<07:01,  5.85s/it]Evaluating...:  50%|████▉     | 70/141 [06:54<06:54,  5.84s/it]Evaluating...:  50%|█████     | 71/141 [07:00<06:49,  5.84s/it]Evaluating...:  51%|█████     | 72/141 [07:06<06:43,  5.85s/it]Evaluating...:  52%|█████▏    | 73/141 [07:12<06:37,  5.85s/it]Evaluating...:  52%|█████▏    | 74/141 [07:18<06:32,  5.85s/it]Evaluating...:  53%|█████▎    | 75/141 [07:23<06:25,  5.84s/it]Evaluating...:  54%|█████▍    | 76/141 [07:29<06:20,  5.85s/it]Evaluating...:  55%|█████▍    | 77/141 [07:35<06:14,  5.85s/it]Evaluating...:  55%|█████▌    | 78/141 [07:41<06:08,  5.85s/it]Evaluating...:  56%|█████▌    | 79/141 [07:47<06:03,  5.86s/it]Evaluating...:  57%|█████▋    | 80/141 [07:53<05:56,  5.84s/it]Evaluating...:  57%|█████▋    | 81/141 [07:58<05:51,  5.85s/it]Evaluating...:  58%|█████▊    | 82/141 [08:04<05:45,  5.85s/it]Evaluating...:  59%|█████▉    | 83/141 [08:10<05:39,  5.85s/it]Evaluating...:  60%|█████▉    | 84/141 [08:16<05:33,  5.85s/it]Evaluating...:  60%|██████    | 85/141 [08:22<05:27,  5.85s/it]Evaluating...:  61%|██████    | 86/141 [08:28<05:21,  5.84s/it]Evaluating...:  62%|██████▏   | 87/141 [08:34<05:15,  5.84s/it]Evaluating...:  62%|██████▏   | 88/141 [08:39<05:09,  5.83s/it]Evaluating...:  63%|██████▎   | 89/141 [08:45<05:03,  5.84s/it]Evaluating...:  64%|██████▍   | 90/141 [08:51<04:57,  5.83s/it]Evaluating...:  65%|██████▍   | 91/141 [08:57<04:52,  5.84s/it]Evaluating...:  65%|██████▌   | 92/141 [09:03<04:46,  5.84s/it]Evaluating...:  66%|██████▌   | 93/141 [09:09<04:40,  5.85s/it]Evaluating...:  67%|██████▋   | 94/141 [09:14<04:34,  5.84s/it]Evaluating...:  67%|██████▋   | 95/141 [09:20<04:28,  5.84s/it]Evaluating...:  68%|██████▊   | 96/141 [09:26<04:22,  5.84s/it]Evaluating...:  69%|██████▉   | 97/141 [09:32<04:16,  5.84s/it]Evaluating...:  70%|██████▉   | 98/141 [09:38<04:11,  5.84s/it]Evaluating...:  70%|███████   | 99/141 [09:44<04:05,  5.84s/it]Evaluating...:  71%|███████   | 100/141 [09:49<03:59,  5.84s/it]Evaluating...:  72%|███████▏  | 101/141 [09:55<03:53,  5.84s/it]Evaluating...:  72%|███████▏  | 102/141 [10:01<03:48,  5.85s/it]Evaluating...:  73%|███████▎  | 103/141 [10:07<03:42,  5.85s/it]Evaluating...:  74%|███████▍  | 104/141 [10:13<03:36,  5.84s/it]Evaluating...:  74%|███████▍  | 105/141 [10:19<03:31,  5.86s/it]Evaluating...:  75%|███████▌  | 106/141 [10:25<03:24,  5.86s/it]Evaluating...:  76%|███████▌  | 107/141 [10:30<03:19,  5.87s/it]Evaluating...:  77%|███████▋  | 108/141 [10:36<03:14,  5.89s/it]Evaluating...:  77%|███████▋  | 109/141 [10:42<03:08,  5.88s/it]Evaluating...:  78%|███████▊  | 110/141 [10:48<03:02,  5.90s/it]Evaluating...:  79%|███████▊  | 111/141 [10:54<02:56,  5.88s/it]Evaluating...:  79%|███████▉  | 112/141 [11:00<02:50,  5.90s/it]Evaluating...:  80%|████████  | 113/141 [11:06<02:45,  5.89s/it]Evaluating...:  81%|████████  | 114/141 [11:12<02:38,  5.89s/it]Evaluating...:  82%|████████▏ | 115/141 [11:18<02:32,  5.88s/it]Evaluating...:  82%|████████▏ | 116/141 [11:23<02:26,  5.85s/it]Evaluating...:  83%|████████▎ | 117/141 [11:29<02:20,  5.85s/it]Evaluating...:  84%|████████▎ | 118/141 [11:35<02:14,  5.84s/it]Evaluating...:  84%|████████▍ | 119/141 [11:41<02:08,  5.85s/it]Evaluating...:  85%|████████▌ | 120/141 [11:47<02:02,  5.86s/it]Evaluating...:  86%|████████▌ | 121/141 [11:53<01:56,  5.85s/it]Evaluating...:  87%|████████▋ | 122/141 [11:58<01:51,  5.85s/it]Evaluating...:  87%|████████▋ | 123/141 [12:04<01:45,  5.84s/it]Evaluating...:  88%|████████▊ | 124/141 [12:10<01:39,  5.85s/it]Evaluating...:  89%|████████▊ | 125/141 [12:16<01:33,  5.86s/it]Evaluating...:  89%|████████▉ | 126/141 [12:22<01:27,  5.85s/it]Evaluating...:  90%|█████████ | 127/141 [12:28<01:21,  5.85s/it]Evaluating...:  91%|█████████ | 128/141 [12:34<01:15,  5.84s/it]Evaluating...:  91%|█████████▏| 129/141 [12:39<01:10,  5.84s/it]Evaluating...:  92%|█████████▏| 130/141 [12:45<01:04,  5.84s/it]Evaluating...:  93%|█████████▎| 131/141 [12:51<00:58,  5.85s/it]Evaluating...:  94%|█████████▎| 132/141 [12:57<00:52,  5.85s/it]Evaluating...:  94%|█████████▍| 133/141 [13:03<00:46,  5.84s/it]Evaluating...:  95%|█████████▌| 134/141 [13:09<00:40,  5.85s/it]Evaluating...:  96%|█████████▌| 135/141 [13:14<00:35,  5.84s/it]Evaluating...:  96%|█████████▋| 136/141 [13:20<00:29,  5.84s/it]Evaluating...:  97%|█████████▋| 137/141 [13:26<00:23,  5.86s/it]Evaluating...:  98%|█████████▊| 138/141 [13:32<00:17,  5.85s/it]Evaluating...:  99%|█████████▊| 139/141 [13:38<00:11,  5.89s/it]Evaluating...:  99%|█████████▉| 140/141 [13:44<00:05,  5.87s/it]Evaluating...: 100%|██████████| 141/141 [13:50<00:00,  5.87s/it]Evaluating...: 100%|██████████| 141/141 [13:50<00:00,  5.89s/it]
Perplexity: 7.766434192657471

Finished evaluation for: lm_head,up_proj,k_proj,v_proj,o_proj,layers.19.self_attn.q_proj,layers.19.mlp.gate_proj,layers.21.self_attn.q_proj,layers.21.mlp.gate_proj,layers.28.self_attn.q_proj,layers.28.mlp.gate_proj,layers.30.self_attn.q_proj,layers.30.mlp.gate_proj,layers.31.self_attn.q_proj,layers.31.mlp.gate_proj

All evaluations completed!
